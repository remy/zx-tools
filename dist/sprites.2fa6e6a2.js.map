{"version":3,"sources":["lib/dnd.js","sprites/lib/colour.js","lib/save.js","sprites/lib/zlib.js","sprites/lib/png.js","sprites/lib/bmp.js","sprites/lib/parser.js","lib/$.js","sprites/SpriteSheet.js","lib/track-down.js","sprites/ImageWindow.js","sprites/ColourPicker.js","sprites/Tool.js","sprites/TileMap.js","bas/codes.js","lib/to.js","lib/unpack/lib.js","lib/unpack/pack.js","bas/txt2bas.js","lib/Tabs.js","sprites/index.js","../node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["drop","root","callback","ondragover","ondragend","addEventListener","e","preventDefault","stopPropagation","console","log","droppedFile","dataTransfer","files","reader","FileReader","onload","event","Uint8Array","target","result","readAsArrayBuffer","rgbFromIndex","index","r","g","b","a","toRGB332","Math","floor","transparent","document","createElement","body","appendChild","style","data","fileName","blob","Blob","Array","isArray","type","url","URL","createObjectURL","href","download","click","revokeObjectURL","DecodeStream","constructor","pos","bufferLength","eof","buffer","prototype","ensureBuffer","decodestream_ensureBuffer","requested","current","byteLength","size","buffer2","i","getByte","decodestream_getByte","readBlock","getBytes","decodestream_getBytes","length","end","bufEnd","subarray","lookChar","decodestream_lookChar","String","fromCharCode","getChar","decodestream_getChar","makeSubStream","decodestream_makeSubstream","start","dict","Stream","skip","decodestream_skip","n","reset","decodestream_reset","FlateStream","codeLenCodeMap","Uint32Array","lengthDecode","distDecode","fixedLitCodeTab","fixedDistCodeTab","error","Error","bytes","bytesPos","cmf","flg","codeSize","codeBuf","call","Object","create","getBits","bits","getCode","table","codes","maxLen","code","codeLen","codeVal","generateHuffmanTable","lengths","len","val","code2","t","repeat","stream","array","offset","what","hdr","blockLen","check","litCodeTable","distCodeTable","numLitCodes","numDistCodes","numCodeLenCodes","codeLenCodeLengths","codeLenCodeTab","codeLengths","slice","limit","code1","dist","k","PNG","data1","palette","imgData","transparency","animation","text","frame","chunkSize","readUInt32","section","width","height","colorType","compressionMethod","filterMethod","interlaceMethod","numFrames","numPlays","Infinity","frames","read","push","xOffset","yOffset","delayNum","readUInt16","delayDen","delay","disposeOp","blendOp","indexed","short","grayscale","rgb","indexOf","key","apply","colors","hasAlphaChannel","includes","pixelBitlength","colorSpace","b1","b2","b3","b4","decodePixels","pixelBytes","pixels","pass","x0","y0","dx","dy","singlePass","w","ceil","h","scanlineLength","row","c","byte","col","left","upper","paeth","upperLeft","p","pa","abs","pb","pc","pixelsPos","bufferPos","j","decodePalette","ret","copyToImageData","imageData","alpha","_decodedPalette","input","v","decode","BmpDecoder","is_with_alpha","DataView","bottom_up","flag","parseHeader","parseRGBA","fileSize","getUint32","reserved","headerSize","getInt32","planes","getUint16","bitPP","compress","rawSize","hr","vr","importantColors","blue","getUint8","green","red","quad","bitn","ArrayBuffer","bit1","xlen","mode","y","line","x","location","bit4","fill","lines","low_nibble","setPixelData","rgbIndex","before","after","bit8","bit15","dif_w","_11111","parseInt","_1_5","B","bit16","maskRed","maskGreen","maskBlue","mask0","ns","bit24","bit32","getData","pngSig","bmpSig","file","isPNG","isBMP","detect","png","bmp","max","BMP","transform","alphaFirst","pngNoTransformFile","res","undefined","ri","gi","bi","ai","d","spriteIndex","spriteRow","dataIndex","ArrayNode","Proxy","set","obj","prop","value","filter","el","on","handler","options","emit","Event","dispatchEvent","$","s","ctx","querySelectorAll","warn","from","pixelLength","colourTable","_","getCoords","rect","getBoundingClientRect","clientX","clientY","top","xyToIndex","emptyCanvas","blankData","Uint8ClampedArray","canvas","blank","ImageData","putImageData","Sprite","getContext","render","pget","pset","clear","canvasToPixels","getImageData","paint","clearRect","imageSmoothingEnabled","drawImage","SpriteSheet","scale","spriteData","sprite","sprites","previewCtx","snapshot","_current","window","hook","hooks","trigger","forEach","copy","clipboard","paste","rebuild","history","splice","_undoPtr","undo","getPreviewElements","map","coords","args","get","renderPreview","draw","classList","remove","add","noop","trackDown","move","down","ImageWindow","__ctx","parent","parentNode","status","pan","zoom","zoomFactor","preZoomDelta","zoomDelta","dataset","delta","pxScale","dragging","_coords","curX","curY","shiftX","neg","shiftY","oncopy","localCords","innerHTML","ColourPicker","html","join","id","container","colour","_history","unshift","values","querySelector","className","_index","selected","Tool","action","shortcuts","types","_selected","state","documentElement","tool","shift","_last","source","dummySpriteSheet","sizes","Map","bank","TileMap","maxWidth","cancel","_tmp","hover","clearHover","active","checked","_sprites","getXY","toBinary","reverse","toString","padStart","toHex","toUpperCase","floatToZX","sign","out","mantissa","zxToFloat","view","exp","frac","pow","toFixed","pattern","typeMap","fn","Int8Array","C","A","Int16Array","S","Uint16Array","Int32Array","I","l","L","little","N","f","Float32Array","Float64Array","TextDecoder","encode","TextEncoder","pack","template","isView","re","RegExp","m","bytePtr","firstChr","defaultLittle","templateCounter","dataLength","exec","isNaN","setUint8","calculateXORChecksum","of","reduce","checksum","item","opTable","entries","acc","str","GOTO","tapHeader","basic","filename","autostart","headerLength","flagByte","p1","p2","asTap","header","dataType","tapData","setUint16","plus3DOSHeader","opts","hType","hOffset","sig","issue","version","hFileLength","hLine","curr","Lexer","buf","bufLen","split","inLiteral","lineNumber","tokens","token","name","_processComment","_processBinary","numeric","_skipNonTokens","charAt","_next","op","_isAlpha","_processIdentifier","_isLiteralNumeric","_isDigit","_processNumber","_isLiteralReset","_isStatementSep","_isSymbol","keys","find","_processQuote","_isNumericSymbol","_isBinary","_isNewLine","_isAlphaNum","_processLiteralNumber","endPos","needsClose","substring","tok","parseFloat","trim","_isOpCode","ignorePeek","next","_peekToken","peeked","tmp","end_index","Tab","hide","display","show","setAttribute","Tabs","selector","panels","ids","tabNav","panel","innerText","title","li","tabs","hash","pushState","spritesContainer","debug","picker","upload","pickerColour","buttons","tileDownloads","newSpriteSheet","confirm","tileMap","renderSpritePreviews","renderCurrentSprite","prompt","imageWindow","fileToImageWindow","importMask","borderColor","currentSprite","totalSprites","startsWith","right","onclick","altKey","ctrlKey","shiftKey","metaKey","buildStyleSheet","css","head","append","focused","fileHandler","into","makePixel","onmousemove","onmouseout","node","nodeName","childNodes","ondrop","Promise","all","resolve","onpaste","items","clipboardData","originalEvent","kind","getAsFile","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","dispose","checkedAssets","assetsToAccept","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","JSON","parse","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","message","stack","overlay","createErrorOverlay","getElementById","stackTrace","getParents","modules","parents","dep","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"sprites.2fa6e6a2.js","sourceRoot":"../public","sourcesContent":["export default function drop(root, callback) {\n  root.ondragover = () => false;\n  root.ondragend = () => false;\n  root.addEventListener(\n    'drop',\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      console.log('on ', root);\n\n      const droppedFile = e.dataTransfer.files[0];\n      const reader = new FileReader();\n      reader.onload = event => {\n        callback(new Uint8Array(event.target.result));\n      };\n      reader.readAsArrayBuffer(droppedFile);\n    },\n    false\n  );\n}\n","export function rgbFromIndex(index) {\n  if (index === 0xe3) {\n    return { r: 0, g: 0, b: 0, a: 0 };\n  }\n\n  let r = (index >> 5) & 0x7;\n  let g = (index >> 2) & 0x7;\n  let b = (index >> 0) & 0x3;\n\n  //make a pure RGB332 colour\n  return {\n    r: (r * 255.0) / 7.0,\n    g: (g * 255.0) / 7.0,\n    b: (b * 255.0) / 3.0,\n    a: 255,\n  };\n}\n\nexport function toRGB332(r, g, b) {\n  return (\n    (Math.floor(r / 32) << 5) + (Math.floor(g / 32) << 2) + Math.floor(b / 64)\n  );\n}\n\nexport const transparent = 0xe3;\n","export default (function() {\n  var a = document.createElement('a');\n  document.body.appendChild(a);\n  a.style = 'display: none';\n  return function(data, fileName) {\n    let blob = null;\n\n    if (data instanceof Blob) {\n      blob = data;\n    } else {\n      if (!Array.isArray(data)) {\n        data = [data];\n      }\n      blob = new Blob(data, { type: 'octet/stream' });\n    }\n    const url = URL.createObjectURL(blob);\n    a.href = url;\n    a.download = fileName;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n})();\n","/*\n * Extracted from pdf.js\n * https://github.com/andreasgal/pdf.js\n *\n * Copyright (c) 2011 Mozilla Foundation\n *\n * Contributors: Andreas Gal <gal@mozilla.com>\n *               Chris G Jones <cjones@mozilla.com>\n *               Shaon Barman <shaon.barman@gmail.com>\n *               Vivien Nicolas <21@vingtetun.org>\n *               Justin D'Arcangelo <justindarc@gmail.com>\n *               Yury Delendik\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nexport const DecodeStream = (function() {\n  function constructor() {\n    this.pos = 0;\n    this.bufferLength = 0;\n    this.eof = false;\n    this.buffer = null;\n  }\n\n  constructor.prototype = {\n    ensureBuffer: function decodestream_ensureBuffer(requested) {\n      var buffer = this.buffer;\n      var current = buffer ? buffer.byteLength : 0;\n      if (requested < current) return buffer;\n      var size = 512;\n      while (size < requested) size <<= 1;\n      var buffer2 = new Uint8Array(size);\n      for (var i = 0; i < current; ++i) buffer2[i] = buffer[i];\n      return (this.buffer = buffer2);\n    },\n    getByte: function decodestream_getByte() {\n      var pos = this.pos;\n      while (this.bufferLength <= pos) {\n        if (this.eof) return null;\n        this.readBlock();\n      }\n      return this.buffer[this.pos++];\n    },\n    getBytes: function decodestream_getBytes(length) {\n      var pos = this.pos;\n\n      if (length) {\n        this.ensureBuffer(pos + length);\n        var end = pos + length;\n\n        while (!this.eof && this.bufferLength < end) this.readBlock();\n\n        var bufEnd = this.bufferLength;\n        if (end > bufEnd) end = bufEnd;\n      } else {\n        while (!this.eof) this.readBlock();\n\n        var end = this.bufferLength;\n      }\n\n      this.pos = end;\n      return this.buffer.subarray(pos, end);\n    },\n    lookChar: function decodestream_lookChar() {\n      var pos = this.pos;\n      while (this.bufferLength <= pos) {\n        if (this.eof) return null;\n        this.readBlock();\n      }\n      return String.fromCharCode(this.buffer[this.pos]);\n    },\n    getChar: function decodestream_getChar() {\n      var pos = this.pos;\n      while (this.bufferLength <= pos) {\n        if (this.eof) return null;\n        this.readBlock();\n      }\n      return String.fromCharCode(this.buffer[this.pos++]);\n    },\n    makeSubStream: function decodestream_makeSubstream(start, length, dict) {\n      var end = start + length;\n      while (this.bufferLength <= end && !this.eof) this.readBlock();\n      return new Stream(this.buffer, start, length, dict);\n    },\n    skip: function decodestream_skip(n) {\n      if (!n) n = 1;\n      this.pos += n;\n    },\n    reset: function decodestream_reset() {\n      this.pos = 0;\n    }\n  };\n\n  return constructor;\n})();\n\nexport const FlateStream = (function() {\n  var codeLenCodeMap = new Uint32Array([\n    16,\n    17,\n    18,\n    0,\n    8,\n    7,\n    9,\n    6,\n    10,\n    5,\n    11,\n    4,\n    12,\n    3,\n    13,\n    2,\n    14,\n    1,\n    15\n  ]);\n\n  var lengthDecode = new Uint32Array([\n    0x00003,\n    0x00004,\n    0x00005,\n    0x00006,\n    0x00007,\n    0x00008,\n    0x00009,\n    0x0000a,\n    0x1000b,\n    0x1000d,\n    0x1000f,\n    0x10011,\n    0x20013,\n    0x20017,\n    0x2001b,\n    0x2001f,\n    0x30023,\n    0x3002b,\n    0x30033,\n    0x3003b,\n    0x40043,\n    0x40053,\n    0x40063,\n    0x40073,\n    0x50083,\n    0x500a3,\n    0x500c3,\n    0x500e3,\n    0x00102,\n    0x00102,\n    0x00102\n  ]);\n\n  var distDecode = new Uint32Array([\n    0x00001,\n    0x00002,\n    0x00003,\n    0x00004,\n    0x10005,\n    0x10007,\n    0x20009,\n    0x2000d,\n    0x30011,\n    0x30019,\n    0x40021,\n    0x40031,\n    0x50041,\n    0x50061,\n    0x60081,\n    0x600c1,\n    0x70101,\n    0x70181,\n    0x80201,\n    0x80301,\n    0x90401,\n    0x90601,\n    0xa0801,\n    0xa0c01,\n    0xb1001,\n    0xb1801,\n    0xc2001,\n    0xc3001,\n    0xd4001,\n    0xd6001\n  ]);\n\n  var fixedLitCodeTab = [\n    new Uint32Array([\n      0x70100,\n      0x80050,\n      0x80010,\n      0x80118,\n      0x70110,\n      0x80070,\n      0x80030,\n      0x900c0,\n      0x70108,\n      0x80060,\n      0x80020,\n      0x900a0,\n      0x80000,\n      0x80080,\n      0x80040,\n      0x900e0,\n      0x70104,\n      0x80058,\n      0x80018,\n      0x90090,\n      0x70114,\n      0x80078,\n      0x80038,\n      0x900d0,\n      0x7010c,\n      0x80068,\n      0x80028,\n      0x900b0,\n      0x80008,\n      0x80088,\n      0x80048,\n      0x900f0,\n      0x70102,\n      0x80054,\n      0x80014,\n      0x8011c,\n      0x70112,\n      0x80074,\n      0x80034,\n      0x900c8,\n      0x7010a,\n      0x80064,\n      0x80024,\n      0x900a8,\n      0x80004,\n      0x80084,\n      0x80044,\n      0x900e8,\n      0x70106,\n      0x8005c,\n      0x8001c,\n      0x90098,\n      0x70116,\n      0x8007c,\n      0x8003c,\n      0x900d8,\n      0x7010e,\n      0x8006c,\n      0x8002c,\n      0x900b8,\n      0x8000c,\n      0x8008c,\n      0x8004c,\n      0x900f8,\n      0x70101,\n      0x80052,\n      0x80012,\n      0x8011a,\n      0x70111,\n      0x80072,\n      0x80032,\n      0x900c4,\n      0x70109,\n      0x80062,\n      0x80022,\n      0x900a4,\n      0x80002,\n      0x80082,\n      0x80042,\n      0x900e4,\n      0x70105,\n      0x8005a,\n      0x8001a,\n      0x90094,\n      0x70115,\n      0x8007a,\n      0x8003a,\n      0x900d4,\n      0x7010d,\n      0x8006a,\n      0x8002a,\n      0x900b4,\n      0x8000a,\n      0x8008a,\n      0x8004a,\n      0x900f4,\n      0x70103,\n      0x80056,\n      0x80016,\n      0x8011e,\n      0x70113,\n      0x80076,\n      0x80036,\n      0x900cc,\n      0x7010b,\n      0x80066,\n      0x80026,\n      0x900ac,\n      0x80006,\n      0x80086,\n      0x80046,\n      0x900ec,\n      0x70107,\n      0x8005e,\n      0x8001e,\n      0x9009c,\n      0x70117,\n      0x8007e,\n      0x8003e,\n      0x900dc,\n      0x7010f,\n      0x8006e,\n      0x8002e,\n      0x900bc,\n      0x8000e,\n      0x8008e,\n      0x8004e,\n      0x900fc,\n      0x70100,\n      0x80051,\n      0x80011,\n      0x80119,\n      0x70110,\n      0x80071,\n      0x80031,\n      0x900c2,\n      0x70108,\n      0x80061,\n      0x80021,\n      0x900a2,\n      0x80001,\n      0x80081,\n      0x80041,\n      0x900e2,\n      0x70104,\n      0x80059,\n      0x80019,\n      0x90092,\n      0x70114,\n      0x80079,\n      0x80039,\n      0x900d2,\n      0x7010c,\n      0x80069,\n      0x80029,\n      0x900b2,\n      0x80009,\n      0x80089,\n      0x80049,\n      0x900f2,\n      0x70102,\n      0x80055,\n      0x80015,\n      0x8011d,\n      0x70112,\n      0x80075,\n      0x80035,\n      0x900ca,\n      0x7010a,\n      0x80065,\n      0x80025,\n      0x900aa,\n      0x80005,\n      0x80085,\n      0x80045,\n      0x900ea,\n      0x70106,\n      0x8005d,\n      0x8001d,\n      0x9009a,\n      0x70116,\n      0x8007d,\n      0x8003d,\n      0x900da,\n      0x7010e,\n      0x8006d,\n      0x8002d,\n      0x900ba,\n      0x8000d,\n      0x8008d,\n      0x8004d,\n      0x900fa,\n      0x70101,\n      0x80053,\n      0x80013,\n      0x8011b,\n      0x70111,\n      0x80073,\n      0x80033,\n      0x900c6,\n      0x70109,\n      0x80063,\n      0x80023,\n      0x900a6,\n      0x80003,\n      0x80083,\n      0x80043,\n      0x900e6,\n      0x70105,\n      0x8005b,\n      0x8001b,\n      0x90096,\n      0x70115,\n      0x8007b,\n      0x8003b,\n      0x900d6,\n      0x7010d,\n      0x8006b,\n      0x8002b,\n      0x900b6,\n      0x8000b,\n      0x8008b,\n      0x8004b,\n      0x900f6,\n      0x70103,\n      0x80057,\n      0x80017,\n      0x8011f,\n      0x70113,\n      0x80077,\n      0x80037,\n      0x900ce,\n      0x7010b,\n      0x80067,\n      0x80027,\n      0x900ae,\n      0x80007,\n      0x80087,\n      0x80047,\n      0x900ee,\n      0x70107,\n      0x8005f,\n      0x8001f,\n      0x9009e,\n      0x70117,\n      0x8007f,\n      0x8003f,\n      0x900de,\n      0x7010f,\n      0x8006f,\n      0x8002f,\n      0x900be,\n      0x8000f,\n      0x8008f,\n      0x8004f,\n      0x900fe,\n      0x70100,\n      0x80050,\n      0x80010,\n      0x80118,\n      0x70110,\n      0x80070,\n      0x80030,\n      0x900c1,\n      0x70108,\n      0x80060,\n      0x80020,\n      0x900a1,\n      0x80000,\n      0x80080,\n      0x80040,\n      0x900e1,\n      0x70104,\n      0x80058,\n      0x80018,\n      0x90091,\n      0x70114,\n      0x80078,\n      0x80038,\n      0x900d1,\n      0x7010c,\n      0x80068,\n      0x80028,\n      0x900b1,\n      0x80008,\n      0x80088,\n      0x80048,\n      0x900f1,\n      0x70102,\n      0x80054,\n      0x80014,\n      0x8011c,\n      0x70112,\n      0x80074,\n      0x80034,\n      0x900c9,\n      0x7010a,\n      0x80064,\n      0x80024,\n      0x900a9,\n      0x80004,\n      0x80084,\n      0x80044,\n      0x900e9,\n      0x70106,\n      0x8005c,\n      0x8001c,\n      0x90099,\n      0x70116,\n      0x8007c,\n      0x8003c,\n      0x900d9,\n      0x7010e,\n      0x8006c,\n      0x8002c,\n      0x900b9,\n      0x8000c,\n      0x8008c,\n      0x8004c,\n      0x900f9,\n      0x70101,\n      0x80052,\n      0x80012,\n      0x8011a,\n      0x70111,\n      0x80072,\n      0x80032,\n      0x900c5,\n      0x70109,\n      0x80062,\n      0x80022,\n      0x900a5,\n      0x80002,\n      0x80082,\n      0x80042,\n      0x900e5,\n      0x70105,\n      0x8005a,\n      0x8001a,\n      0x90095,\n      0x70115,\n      0x8007a,\n      0x8003a,\n      0x900d5,\n      0x7010d,\n      0x8006a,\n      0x8002a,\n      0x900b5,\n      0x8000a,\n      0x8008a,\n      0x8004a,\n      0x900f5,\n      0x70103,\n      0x80056,\n      0x80016,\n      0x8011e,\n      0x70113,\n      0x80076,\n      0x80036,\n      0x900cd,\n      0x7010b,\n      0x80066,\n      0x80026,\n      0x900ad,\n      0x80006,\n      0x80086,\n      0x80046,\n      0x900ed,\n      0x70107,\n      0x8005e,\n      0x8001e,\n      0x9009d,\n      0x70117,\n      0x8007e,\n      0x8003e,\n      0x900dd,\n      0x7010f,\n      0x8006e,\n      0x8002e,\n      0x900bd,\n      0x8000e,\n      0x8008e,\n      0x8004e,\n      0x900fd,\n      0x70100,\n      0x80051,\n      0x80011,\n      0x80119,\n      0x70110,\n      0x80071,\n      0x80031,\n      0x900c3,\n      0x70108,\n      0x80061,\n      0x80021,\n      0x900a3,\n      0x80001,\n      0x80081,\n      0x80041,\n      0x900e3,\n      0x70104,\n      0x80059,\n      0x80019,\n      0x90093,\n      0x70114,\n      0x80079,\n      0x80039,\n      0x900d3,\n      0x7010c,\n      0x80069,\n      0x80029,\n      0x900b3,\n      0x80009,\n      0x80089,\n      0x80049,\n      0x900f3,\n      0x70102,\n      0x80055,\n      0x80015,\n      0x8011d,\n      0x70112,\n      0x80075,\n      0x80035,\n      0x900cb,\n      0x7010a,\n      0x80065,\n      0x80025,\n      0x900ab,\n      0x80005,\n      0x80085,\n      0x80045,\n      0x900eb,\n      0x70106,\n      0x8005d,\n      0x8001d,\n      0x9009b,\n      0x70116,\n      0x8007d,\n      0x8003d,\n      0x900db,\n      0x7010e,\n      0x8006d,\n      0x8002d,\n      0x900bb,\n      0x8000d,\n      0x8008d,\n      0x8004d,\n      0x900fb,\n      0x70101,\n      0x80053,\n      0x80013,\n      0x8011b,\n      0x70111,\n      0x80073,\n      0x80033,\n      0x900c7,\n      0x70109,\n      0x80063,\n      0x80023,\n      0x900a7,\n      0x80003,\n      0x80083,\n      0x80043,\n      0x900e7,\n      0x70105,\n      0x8005b,\n      0x8001b,\n      0x90097,\n      0x70115,\n      0x8007b,\n      0x8003b,\n      0x900d7,\n      0x7010d,\n      0x8006b,\n      0x8002b,\n      0x900b7,\n      0x8000b,\n      0x8008b,\n      0x8004b,\n      0x900f7,\n      0x70103,\n      0x80057,\n      0x80017,\n      0x8011f,\n      0x70113,\n      0x80077,\n      0x80037,\n      0x900cf,\n      0x7010b,\n      0x80067,\n      0x80027,\n      0x900af,\n      0x80007,\n      0x80087,\n      0x80047,\n      0x900ef,\n      0x70107,\n      0x8005f,\n      0x8001f,\n      0x9009f,\n      0x70117,\n      0x8007f,\n      0x8003f,\n      0x900df,\n      0x7010f,\n      0x8006f,\n      0x8002f,\n      0x900bf,\n      0x8000f,\n      0x8008f,\n      0x8004f,\n      0x900ff\n    ]),\n    9\n  ];\n\n  var fixedDistCodeTab = [\n    new Uint32Array([\n      0x50000,\n      0x50010,\n      0x50008,\n      0x50018,\n      0x50004,\n      0x50014,\n      0x5000c,\n      0x5001c,\n      0x50002,\n      0x50012,\n      0x5000a,\n      0x5001a,\n      0x50006,\n      0x50016,\n      0x5000e,\n      0x00000,\n      0x50001,\n      0x50011,\n      0x50009,\n      0x50019,\n      0x50005,\n      0x50015,\n      0x5000d,\n      0x5001d,\n      0x50003,\n      0x50013,\n      0x5000b,\n      0x5001b,\n      0x50007,\n      0x50017,\n      0x5000f,\n      0x00000\n    ]),\n    5\n  ];\n\n  function error(e) {\n    throw new Error(e);\n  }\n\n  function constructor(bytes) {\n    //var bytes = stream.getBytes();\n    var bytesPos = 0;\n\n    var cmf = bytes[bytesPos++];\n    var flg = bytes[bytesPos++];\n    if (cmf == -1 || flg == -1) error(\"Invalid header in flate stream\");\n    if ((cmf & 0x0f) != 0x08)\n      error(\"Unknown compression method in flate stream\");\n    if (((cmf << 8) + flg) % 31 != 0) error(\"Bad FCHECK in flate stream\");\n    if (flg & 0x20) error(\"FDICT bit set in flate stream\");\n\n    this.bytes = bytes;\n    this.bytesPos = bytesPos;\n\n    this.codeSize = 0;\n    this.codeBuf = 0;\n\n    DecodeStream.call(this);\n  }\n\n  constructor.prototype = Object.create(DecodeStream.prototype);\n\n  constructor.prototype.getBits = function(bits) {\n    var codeSize = this.codeSize;\n    var codeBuf = this.codeBuf;\n    var bytes = this.bytes;\n    var bytesPos = this.bytesPos;\n\n    var b;\n    while (codeSize < bits) {\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad encoding in flate stream\");\n      codeBuf |= b << codeSize;\n      codeSize += 8;\n    }\n    b = codeBuf & ((1 << bits) - 1);\n    this.codeBuf = codeBuf >> bits;\n    this.codeSize = codeSize -= bits;\n    this.bytesPos = bytesPos;\n    return b;\n  };\n\n  constructor.prototype.getCode = function(table) {\n    var codes = table[0];\n    var maxLen = table[1];\n    var codeSize = this.codeSize;\n    var codeBuf = this.codeBuf;\n    var bytes = this.bytes;\n    var bytesPos = this.bytesPos;\n\n    while (codeSize < maxLen) {\n      var b;\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad encoding in flate stream\");\n      codeBuf |= b << codeSize;\n      codeSize += 8;\n    }\n    var code = codes[codeBuf & ((1 << maxLen) - 1)];\n    var codeLen = code >> 16;\n    var codeVal = code & 0xffff;\n    if (codeSize == 0 || codeSize < codeLen || codeLen == 0)\n      error(\"Bad encoding in flate stream\");\n    this.codeBuf = codeBuf >> codeLen;\n    this.codeSize = codeSize - codeLen;\n    this.bytesPos = bytesPos;\n    return codeVal;\n  };\n\n  constructor.prototype.generateHuffmanTable = function(lengths) {\n    var n = lengths.length;\n\n    // find max code length\n    var maxLen = 0;\n    for (var i = 0; i < n; ++i) {\n      if (lengths[i] > maxLen) maxLen = lengths[i];\n    }\n\n    // build the table\n    var size = 1 << maxLen;\n    var codes = new Uint32Array(size);\n    for (\n      var len = 1, code = 0, skip = 2;\n      len <= maxLen;\n      ++len, code <<= 1, skip <<= 1\n    ) {\n      for (var val = 0; val < n; ++val) {\n        if (lengths[val] == len) {\n          // bit-reverse the code\n          var code2 = 0;\n          var t = code;\n          for (var i = 0; i < len; ++i) {\n            code2 = (code2 << 1) | (t & 1);\n            t >>= 1;\n          }\n\n          // fill the table entries\n          for (var i = code2; i < size; i += skip) codes[i] = (len << 16) | val;\n\n          ++code;\n        }\n      }\n    }\n\n    return [codes, maxLen];\n  };\n\n  constructor.prototype.readBlock = function() {\n    function repeat(stream, array, len, offset, what) {\n      var repeat = stream.getBits(len) + offset;\n      while (repeat-- > 0) array[i++] = what;\n    }\n\n    // read block header\n    var hdr = this.getBits(3);\n    if (hdr & 1) this.eof = true;\n    hdr >>= 1;\n\n    if (hdr == 0) {\n      // uncompressed block\n      var bytes = this.bytes;\n      var bytesPos = this.bytesPos;\n      var b;\n\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad block header in flate stream\");\n      var blockLen = b;\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad block header in flate stream\");\n      blockLen |= b << 8;\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad block header in flate stream\");\n      var check = b;\n      if (typeof (b = bytes[bytesPos++]) == \"undefined\")\n        error(\"Bad block header in flate stream\");\n      check |= b << 8;\n      if (check != (~blockLen & 0xffff))\n        error(\"Bad uncompressed block length in flate stream\");\n\n      this.codeBuf = 0;\n      this.codeSize = 0;\n\n      var bufferLength = this.bufferLength;\n      var buffer = this.ensureBuffer(bufferLength + blockLen);\n      var end = bufferLength + blockLen;\n      this.bufferLength = end;\n      for (var n = bufferLength; n < end; ++n) {\n        if (typeof (b = bytes[bytesPos++]) == \"undefined\") {\n          this.eof = true;\n          break;\n        }\n        buffer[n] = b;\n      }\n      this.bytesPos = bytesPos;\n      return;\n    }\n\n    var litCodeTable;\n    var distCodeTable;\n    if (hdr == 1) {\n      // compressed block, fixed codes\n      litCodeTable = fixedLitCodeTab;\n      distCodeTable = fixedDistCodeTab;\n    } else if (hdr == 2) {\n      // compressed block, dynamic codes\n      var numLitCodes = this.getBits(5) + 257;\n      var numDistCodes = this.getBits(5) + 1;\n      var numCodeLenCodes = this.getBits(4) + 4;\n\n      // build the code lengths code table\n      var codeLenCodeLengths = Array(codeLenCodeMap.length);\n      var i = 0;\n      while (i < numCodeLenCodes)\n        codeLenCodeLengths[codeLenCodeMap[i++]] = this.getBits(3);\n      var codeLenCodeTab = this.generateHuffmanTable(codeLenCodeLengths);\n\n      // build the literal and distance code tables\n      var len = 0;\n      var i = 0;\n      var codes = numLitCodes + numDistCodes;\n      var codeLengths = new Array(codes);\n      while (i < codes) {\n        var code = this.getCode(codeLenCodeTab);\n        if (code == 16) {\n          repeat(this, codeLengths, 2, 3, len);\n        } else if (code == 17) {\n          repeat(this, codeLengths, 3, 3, (len = 0));\n        } else if (code == 18) {\n          repeat(this, codeLengths, 7, 11, (len = 0));\n        } else {\n          codeLengths[i++] = len = code;\n        }\n      }\n\n      litCodeTable = this.generateHuffmanTable(\n        codeLengths.slice(0, numLitCodes)\n      );\n      distCodeTable = this.generateHuffmanTable(\n        codeLengths.slice(numLitCodes, codes)\n      );\n    } else {\n      error(\"Unknown block type in flate stream\");\n    }\n\n    var buffer = this.buffer;\n    var limit = buffer ? buffer.length : 0;\n    var pos = this.bufferLength;\n    while (true) {\n      var code1 = this.getCode(litCodeTable);\n      if (code1 < 256) {\n        if (pos + 1 >= limit) {\n          buffer = this.ensureBuffer(pos + 1);\n          limit = buffer.length;\n        }\n        buffer[pos++] = code1;\n        continue;\n      }\n      if (code1 == 256) {\n        this.bufferLength = pos;\n        return;\n      }\n      code1 -= 257;\n      code1 = lengthDecode[code1];\n      var code2 = code1 >> 16;\n      if (code2 > 0) code2 = this.getBits(code2);\n      var len = (code1 & 0xffff) + code2;\n      code1 = this.getCode(distCodeTable);\n      code1 = distDecode[code1];\n      code2 = code1 >> 16;\n      if (code2 > 0) code2 = this.getBits(code2);\n      var dist = (code1 & 0xffff) + code2;\n      if (pos + len >= limit) {\n        buffer = this.ensureBuffer(pos + len);\n        limit = buffer.length;\n      }\n      for (var k = 0; k < len; ++k, ++pos) buffer[pos] = buffer[pos - dist];\n    }\n  };\n\n  return constructor;\n})();\n","/*\n * MIT LICENSE\n * Copyright (c) 2011 Devon Govett\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this\n * software and associated documentation files (the \"Software\"), to deal in the Software\n * without restriction, including without limitation the rights to use, copy, modify, merge,\n * publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons\n * to whom the Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all copies or\n * substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport { FlateStream } from './zlib.js';\n\nexport default class PNG {\n  constructor(data1) {\n    let i;\n    this.data = data1;\n    this.pos = 8; // Skip the default header\n\n    this.palette = [];\n    this.imgData = [];\n    this.transparency = {};\n    this.animation = null;\n    this.text = {};\n    let frame = null;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      var data;\n      let chunkSize = this.readUInt32();\n      let section = '';\n      for (i = 0; i < 4; i++) {\n        section += String.fromCharCode(this.data[this.pos++]);\n      }\n\n      switch (section) {\n        case 'IHDR':\n          // we can grab  interesting values from here (like width, height, etc)\n          this.width = this.readUInt32();\n          this.height = this.readUInt32();\n          this.bits = this.data[this.pos++];\n          this.colorType = this.data[this.pos++];\n          this.compressionMethod = this.data[this.pos++];\n          this.filterMethod = this.data[this.pos++];\n          this.interlaceMethod = this.data[this.pos++];\n          break;\n\n        case 'acTL':\n          // we have an animated PNG\n          this.animation = {\n            numFrames: this.readUInt32(),\n            numPlays: this.readUInt32() || Infinity,\n            frames: [],\n          };\n          break;\n\n        case 'PLTE':\n          this.palette = this.read(chunkSize);\n          break;\n\n        case 'fcTL':\n          if (frame) {\n            this.animation.frames.push(frame);\n          }\n\n          this.pos += 4; // skip sequence number\n          frame = {\n            width: this.readUInt32(),\n            height: this.readUInt32(),\n            xOffset: this.readUInt32(),\n            yOffset: this.readUInt32(),\n          };\n\n          var delayNum = this.readUInt16();\n          var delayDen = this.readUInt16() || 100;\n          frame.delay = (1000 * delayNum) / delayDen;\n\n          frame.disposeOp = this.data[this.pos++];\n          frame.blendOp = this.data[this.pos++];\n          frame.data = [];\n          break;\n\n        case 'IDAT':\n        case 'fdAT':\n          if (section === 'fdAT') {\n            this.pos += 4; // skip sequence number\n            chunkSize -= 4;\n          }\n\n          data = (frame && frame.data) || this.imgData;\n          for (i = 0; i < chunkSize; i++) {\n            data.push(this.data[this.pos++]);\n          }\n          break;\n\n        case 'tRNS':\n          // This chunk can only occur once and it must occur after the\n          // PLTE chunk and before the IDAT chunk.\n          this.transparency = {};\n          switch (this.colorType) {\n            case 3:\n              // Indexed color, RGB. Each byte in this chunk is an alpha for\n              // the palette index in the PLTE (\"palette\") chunk up until the\n              // last non-opaque entry. Set up an array, stretching over all\n              // palette entries which will be 0 (opaque) or 1 (transparent).\n              this.transparency.indexed = this.read(chunkSize);\n              var short = 255 - this.transparency.indexed.length;\n              if (short > 0) {\n                for (i = 0; i < short; i++) {\n                  this.transparency.indexed.push(255);\n                }\n              }\n              break;\n            case 0:\n              // Greyscale. Corresponding to entries in the PLTE chunk.\n              // Grey is two bytes, range 0 .. (2 ^ bit-depth) - 1\n              this.transparency.grayscale = this.read(chunkSize)[0];\n              break;\n            case 2:\n              // True color with proper alpha channel.\n              this.transparency.rgb = this.read(chunkSize);\n              break;\n          }\n          break;\n\n        case 'tEXt':\n          var text = this.read(chunkSize);\n          var index = text.indexOf(0);\n          var key = String.fromCharCode.apply(String, text.slice(0, index));\n          this.text[key] = String.fromCharCode.apply(\n            String,\n            text.slice(index + 1)\n          );\n          break;\n\n        case 'IEND':\n          if (frame) {\n            this.animation.frames.push(frame);\n          }\n\n          // we've got everything we need!\n          switch (this.colorType) {\n            case 0:\n            case 3:\n            case 4:\n              this.colors = 1;\n              break;\n            case 2:\n            case 6:\n              this.colors = 3;\n              break;\n          }\n\n          this.hasAlphaChannel = [4, 6].includes(this.colorType);\n          var colors = this.colors + (this.hasAlphaChannel ? 1 : 0);\n          this.pixelBitlength = this.bits * colors;\n\n          switch (this.colors) {\n            case 1:\n              this.colorSpace = 'DeviceGray';\n              break;\n            case 3:\n              this.colorSpace = 'DeviceRGB';\n              break;\n          }\n\n          this.imgData = new Uint8Array(this.imgData);\n          return;\n\n        default:\n          // unknown (or unimportant) section, skip it\n          this.pos += chunkSize;\n      }\n\n      this.pos += 4; // Skip the CRC\n\n      if (this.pos > this.data.length) {\n        throw new Error('Incomplete or corrupt PNG file');\n      }\n    }\n  }\n\n  read(bytes) {\n    const result = new Array(bytes);\n    for (let i = 0; i < bytes; i++) {\n      result[i] = this.data[this.pos++];\n    }\n    return result;\n  }\n\n  readUInt32() {\n    const b1 = this.data[this.pos++] << 24;\n    const b2 = this.data[this.pos++] << 16;\n    const b3 = this.data[this.pos++] << 8;\n    const b4 = this.data[this.pos++];\n    return b1 | b2 | b3 | b4;\n  }\n\n  readUInt16() {\n    const b1 = this.data[this.pos++] << 8;\n    const b2 = this.data[this.pos++];\n    return b1 | b2;\n  }\n\n  decodePixels(data) {\n    if (data == null) {\n      data = this.imgData;\n    }\n    if (data.length === 0) {\n      return new Uint8Array(0);\n    }\n\n    data = new FlateStream(data);\n    data = data.getBytes();\n\n    const { width, height } = this;\n    const pixelBytes = this.pixelBitlength / 8;\n\n    const pixels = new Uint8Array(width * height * pixelBytes);\n    const { length } = data;\n    let pos = 0;\n\n    function pass(x0, y0, dx, dy, singlePass = false) {\n      const w = Math.ceil((width - x0) / dx);\n      const h = Math.ceil((height - y0) / dy);\n      const scanlineLength = pixelBytes * w;\n      const buffer = singlePass ? pixels : new Uint8Array(scanlineLength * h);\n      let row = 0;\n      let c = 0;\n      while (row < h && pos < length) {\n        var byte, col, i, left, upper;\n        switch (data[pos++]) {\n          case 0: // None\n            for (i = 0; i < scanlineLength; i++) {\n              buffer[c++] = data[pos++];\n            }\n            break;\n\n          case 1: // Sub\n            for (i = 0; i < scanlineLength; i++) {\n              byte = data[pos++];\n              left = i < pixelBytes ? 0 : buffer[c - pixelBytes];\n              buffer[c++] = (byte + left) % 256;\n            }\n            break;\n\n          case 2: // Up\n            for (i = 0; i < scanlineLength; i++) {\n              byte = data[pos++];\n              col = (i - (i % pixelBytes)) / pixelBytes;\n              upper =\n                row &&\n                buffer[\n                  (row - 1) * scanlineLength +\n                    col * pixelBytes +\n                    (i % pixelBytes)\n                ];\n              buffer[c++] = (upper + byte) % 256;\n            }\n            break;\n\n          case 3: // Average\n            for (i = 0; i < scanlineLength; i++) {\n              byte = data[pos++];\n              col = (i - (i % pixelBytes)) / pixelBytes;\n              left = i < pixelBytes ? 0 : buffer[c - pixelBytes];\n              upper =\n                row &&\n                buffer[\n                  (row - 1) * scanlineLength +\n                    col * pixelBytes +\n                    (i % pixelBytes)\n                ];\n              buffer[c++] = (byte + Math.floor((left + upper) / 2)) % 256;\n            }\n            break;\n\n          case 4: // Paeth\n            for (i = 0; i < scanlineLength; i++) {\n              var paeth, upperLeft;\n              byte = data[pos++];\n              col = (i - (i % pixelBytes)) / pixelBytes;\n              left = i < pixelBytes ? 0 : buffer[c - pixelBytes];\n\n              if (row === 0) {\n                upper = upperLeft = 0;\n              } else {\n                upper =\n                  buffer[\n                    (row - 1) * scanlineLength +\n                      col * pixelBytes +\n                      (i % pixelBytes)\n                  ];\n                upperLeft =\n                  col &&\n                  buffer[\n                    (row - 1) * scanlineLength +\n                      (col - 1) * pixelBytes +\n                      (i % pixelBytes)\n                  ];\n              }\n\n              const p = left + upper - upperLeft;\n              const pa = Math.abs(p - left);\n              const pb = Math.abs(p - upper);\n              const pc = Math.abs(p - upperLeft);\n\n              if (pa <= pb && pa <= pc) {\n                paeth = left;\n              } else if (pb <= pc) {\n                paeth = upper;\n              } else {\n                paeth = upperLeft;\n              }\n\n              buffer[c++] = (byte + paeth) % 256;\n            }\n            break;\n\n          default:\n            throw new Error(`Invalid filter algorithm: ${data[pos - 1]}`);\n        }\n\n        if (!singlePass) {\n          let pixelsPos = ((y0 + row * dy) * width + x0) * pixelBytes;\n          let bufferPos = row * scanlineLength;\n          for (i = 0; i < w; i++) {\n            for (let j = 0; j < pixelBytes; j++)\n              pixels[pixelsPos++] = buffer[bufferPos++];\n            pixelsPos += (dx - 1) * pixelBytes;\n          }\n        }\n\n        row++;\n      }\n    }\n\n    if (this.interlaceMethod === 1) {\n      /*\n          1 6 4 6 2 6 4 6\n          7 7 7 7 7 7 7 7\n          5 6 5 6 5 6 5 6\n          7 7 7 7 7 7 7 7\n          3 6 4 6 3 6 4 6\n          7 7 7 7 7 7 7 7\n          5 6 5 6 5 6 5 6\n          7 7 7 7 7 7 7 7\n        */\n      pass(0, 0, 8, 8); // 1\n      pass(4, 0, 8, 8); // 2\n      pass(0, 4, 4, 8); // 3\n      pass(2, 0, 4, 4); // 4\n      pass(0, 2, 2, 4); // 5\n      pass(1, 0, 2, 2); // 6\n      pass(0, 1, 1, 2); // 7\n    } else {\n      pass(0, 0, 1, 1, true);\n    }\n\n    return pixels;\n  }\n\n  decodePalette() {\n    const { palette } = this;\n    const { length } = palette;\n    const transparency = this.transparency.indexed || [];\n    const ret = new Uint8Array((transparency.length || 0) + length);\n    let pos = 0;\n    let c = 0;\n\n    for (let i = 0; i < length; i += 3) {\n      var left;\n      ret[pos++] = palette[i];\n      ret[pos++] = palette[i + 1];\n      ret[pos++] = palette[i + 2];\n      ret[pos++] = (left = transparency[c++]) != null ? left : 255;\n    }\n\n    return ret;\n  }\n\n  copyToImageData(imageData, pixels) {\n    let j, k;\n    let { colors } = this;\n    let palette = null;\n    let alpha = this.hasAlphaChannel;\n\n    if (this.palette.length) {\n      palette =\n        this._decodedPalette || (this._decodedPalette = this.decodePalette());\n      colors = 4;\n      alpha = true;\n    }\n\n    const data = imageData.data || imageData;\n    const { length } = data;\n    const input = palette || pixels;\n    let i = (j = 0);\n\n    if (colors === 1) {\n      while (i < length) {\n        k = palette ? pixels[i / 4] * 4 : j;\n        const v = input[k++];\n        data[i++] = v;\n        data[i++] = v;\n        data[i++] = v;\n        data[i++] = alpha ? input[k++] : 255;\n        j = k;\n      }\n    } else {\n      while (i < length) {\n        k = palette ? pixels[i / 4] * 4 : j;\n        data[i++] = input[k++];\n        data[i++] = input[k++];\n        data[i++] = input[k++];\n        data[i++] = alpha ? input[k++] : 255;\n        j = k;\n      }\n    }\n  }\n\n  decode() {\n    const ret = new Uint8Array(this.width * this.height * 4);\n    this.copyToImageData(ret, this.decodePixels());\n    return ret;\n  }\n}\n","/**\n * @author shaozilee\n *\n * Bmp format decoder,support 1bit 4bit 8bit 24bit bmp\n *\n */\n\nexport default function BmpDecoder(buffer, is_with_alpha) {\n  this.pos = 2;\n  this.buffer = new DataView(buffer.buffer);\n  this.is_with_alpha = !!is_with_alpha;\n  this.bottom_up = true;\n  this.flag = buffer.slice(0, 2);\n\n  if (this.flag[0] !== 66 || this.flag[1] !== 77)\n    throw new Error('Invalid BMP File');\n  this.parseHeader();\n  this.parseRGBA();\n}\n\nBmpDecoder.prototype.parseHeader = function() {\n  this.fileSize = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.reserved = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.offset = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.headerSize = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.width = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.height = this.buffer.getInt32(this.pos, true);\n  this.pos += 4;\n  this.planes = this.buffer.getUint16(this.pos, true);\n  this.pos += 2;\n  this.bitPP = this.buffer.getUint16(this.pos, true);\n  this.pos += 2;\n  this.compress = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.rawSize = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.hr = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.vr = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.colors = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n  this.importantColors = this.buffer.getUint32(this.pos, true);\n  this.pos += 4;\n\n  if (this.bitPP === 16 && this.is_with_alpha) {\n    this.bitPP = 15;\n  }\n  if (this.bitPP < 15) {\n    var len = this.colors === 0 ? 1 << this.bitPP : this.colors;\n    this.palette = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var blue = this.buffer.getUint8(this.pos++);\n      var green = this.buffer.getUint8(this.pos++);\n      var red = this.buffer.getUint8(this.pos++);\n      var quad = this.buffer.getUint8(this.pos++);\n      this.palette[i] = {\n        red: red,\n        green: green,\n        blue: blue,\n        quad: quad,\n      };\n    }\n  }\n  if (this.height < 0) {\n    this.height *= -1;\n    this.bottom_up = false;\n  }\n};\n\nBmpDecoder.prototype.parseRGBA = function() {\n  var bitn = 'bit' + this.bitPP;\n  var len = this.width * this.height * 4;\n  this.data = new ArrayBuffer(len);\n  this[bitn]();\n};\n\nBmpDecoder.prototype.bit1 = function() {\n  var xlen = Math.ceil(this.width / 8);\n  var mode = xlen % 4;\n  var y = this.height >= 0 ? this.height - 1 : -this.height;\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n    for (var x = 0; x < xlen; x++) {\n      var b = this.buffer.getUint8(this.pos++);\n      var location = line * this.width * 4 + x * 8 * 4;\n      for (var i = 0; i < 8; i++) {\n        if (x * 8 + i < this.width) {\n          var rgb = this.palette[(b >> (7 - i)) & 0x1];\n\n          this.data[location + i * 4] = 0;\n          this.data[location + i * 4 + 1] = rgb.blue;\n          this.data[location + i * 4 + 2] = rgb.green;\n          this.data[location + i * 4 + 3] = rgb.red;\n        } else {\n          break;\n        }\n      }\n    }\n\n    if (mode != 0) {\n      this.pos += 4 - mode;\n    }\n  }\n};\n\nBmpDecoder.prototype.bit4 = function() {\n  //RLE-4\n  if (this.compress == 2) {\n    this.data.fill(0xff);\n\n    var location = 0;\n    var lines = this.bottom_up ? this.height - 1 : 0;\n    var low_nibble = false; //for all count of pixel\n\n    while (location < this.data.length) {\n      var a = this.buffer.getUint8(this.pos++);\n      var b = this.buffer.getUint8(this.pos++);\n      //absolute mode\n      if (a == 0) {\n        if (b == 0) {\n          //line end\n          if (this.bottom_up) {\n            lines--;\n          } else {\n            lines++;\n          }\n          location = lines * this.width * 4;\n          low_nibble = false;\n          continue;\n        } else if (b == 1) {\n          //image end\n          break;\n        } else if (b == 2) {\n          //offset x,y\n          var x = this.buffer.getUint8(this.pos++);\n          var y = this.buffer.getUint8(this.pos++);\n          if (this.bottom_up) {\n            lines -= y;\n          } else {\n            lines += y;\n          }\n\n          location += y * this.width * 4 + x * 4;\n        } else {\n          var c = this.buffer.getUint8(this.pos++);\n          for (var i = 0; i < b; i++) {\n            if (low_nibble) {\n              setPixelData.call(this, c & 0x0f);\n            } else {\n              setPixelData.call(this, (c & 0xf0) >> 4);\n            }\n\n            if (i & 1 && i + 1 < b) {\n              c = this.buffer.getUint8(this.pos++);\n            }\n\n            low_nibble = !low_nibble;\n          }\n\n          if ((((b + 1) >> 1) & 1) == 1) {\n            this.pos++;\n          }\n        }\n      } else {\n        //encoded mode\n        for (var i = 0; i < a; i++) {\n          if (low_nibble) {\n            setPixelData.call(this, b & 0x0f);\n          } else {\n            setPixelData.call(this, (b & 0xf0) >> 4);\n          }\n          low_nibble = !low_nibble;\n        }\n      }\n    }\n\n    function setPixelData(rgbIndex) {\n      var rgb = this.palette[rgbIndex];\n      this.data[location] = 0;\n      this.data[location + 1] = rgb.blue;\n      this.data[location + 2] = rgb.green;\n      this.data[location + 3] = rgb.red;\n      location += 4;\n    }\n  } else {\n    var xlen = Math.ceil(this.width / 2);\n    var mode = xlen % 4;\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n      for (var x = 0; x < xlen; x++) {\n        var b = this.buffer.getUint8(this.pos++);\n        var location = line * this.width * 4 + x * 2 * 4;\n\n        var before = b >> 4;\n        var after = b & 0x0f;\n\n        var rgb = this.palette[before];\n        this.data[location] = 0;\n        this.data[location + 1] = rgb.blue;\n        this.data[location + 2] = rgb.green;\n        this.data[location + 3] = rgb.red;\n\n        if (x * 2 + 1 >= this.width) break;\n\n        rgb = this.palette[after];\n\n        this.data[location + 4] = 0;\n        this.data[location + 4 + 1] = rgb.blue;\n        this.data[location + 4 + 2] = rgb.green;\n        this.data[location + 4 + 3] = rgb.red;\n      }\n\n      if (mode != 0) {\n        this.pos += 4 - mode;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.bit8 = function() {\n  //RLE-8\n  if (this.compress == 1) {\n    this.data.fill(0xff);\n\n    var location = 0;\n    var lines = this.bottom_up ? this.height - 1 : 0;\n\n    while (location < this.data.length) {\n      var a = this.buffer.getUint8(this.pos++);\n      var b = this.buffer.getUint8(this.pos++);\n      //absolute mode\n      if (a == 0) {\n        if (b == 0) {\n          //line end\n          if (this.bottom_up) {\n            lines--;\n          } else {\n            lines++;\n          }\n          location = lines * this.width * 4;\n          continue;\n        } else if (b == 1) {\n          //image end\n          break;\n        } else if (b == 2) {\n          //offset x,y\n          var x = this.buffer.getUint8(this.pos++);\n          var y = this.buffer.getUint8(this.pos++);\n          if (this.bottom_up) {\n            lines -= y;\n          } else {\n            lines += y;\n          }\n\n          location += y * this.width * 4 + x * 4;\n        } else {\n          for (var i = 0; i < b; i++) {\n            var c = this.buffer.getUint8(this.pos++);\n            setPixelData.call(this, c);\n          }\n          if (b & (1 == 1)) {\n            this.pos++;\n          }\n        }\n      } else {\n        //encoded mode\n        for (var i = 0; i < a; i++) {\n          setPixelData.call(this, b);\n        }\n      }\n    }\n\n    function setPixelData(rgbIndex) {\n      var rgb = this.palette[rgbIndex];\n      this.data[location] = 0;\n      this.data[location + 1] = rgb.blue;\n      this.data[location + 2] = rgb.green;\n      this.data[location + 3] = rgb.red;\n      location += 4;\n    }\n  } else {\n    var mode = this.width % 4;\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n      for (var x = 0; x < this.width; x++) {\n        var b = this.buffer.getUint8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n        if (b < this.palette.length) {\n          var rgb = this.palette[b];\n\n          this.data[location] = 0;\n          this.data[location + 1] = rgb.blue;\n          this.data[location + 2] = rgb.green;\n          this.data[location + 3] = rgb.red;\n        } else {\n          this.data[location] = 0;\n          this.data[location + 1] = 0xff;\n          this.data[location + 2] = 0xff;\n          this.data[location + 3] = 0xff;\n        }\n      }\n      if (mode != 0) {\n        this.pos += 4 - mode;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.bit15 = function() {\n  var dif_w = this.width % 3;\n  var _11111 = parseInt('11111', 2),\n    _1_5 = _11111;\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n    for (var x = 0; x < this.width; x++) {\n      var B = this.buffer.getUint16(this.pos, true);\n      this.pos += 2;\n      var blue = (((B & _1_5) / _1_5) * 255) | 0;\n      var green = ((((B >> 5) & _1_5) / _1_5) * 255) | 0;\n      var red = ((((B >> 10) & _1_5) / _1_5) * 255) | 0;\n      var alpha = B >> 15 ? 0xff : 0x00;\n\n      var location = line * this.width * 4 + x * 4;\n\n      this.data[location] = alpha;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit16 = function() {\n  var dif_w = (this.width % 2) * 2;\n  //default xrgb555\n  this.maskRed = 0x7c00;\n  this.maskGreen = 0x3e0;\n  this.maskBlue = 0x1f;\n  this.mask0 = 0;\n\n  if (this.compress == 3) {\n    this.maskRed = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.maskGreen = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.maskBlue = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.mask0 = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n  }\n\n  var ns = [0, 0, 0];\n  for (var i = 0; i < 16; i++) {\n    if ((this.maskRed >> i) & 0x01) ns[0]++;\n    if ((this.maskGreen >> i) & 0x01) ns[1]++;\n    if ((this.maskBlue >> i) & 0x01) ns[2]++;\n  }\n  ns[1] += ns[0];\n  ns[2] += ns[1];\n  ns[0] = 8 - ns[0];\n  ns[1] -= 8;\n  ns[2] -= 8;\n\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n    for (var x = 0; x < this.width; x++) {\n      var B = this.buffer.getUint16(this.pos, true);\n      this.pos += 2;\n\n      var blue = (B & this.maskBlue) << ns[0];\n      var green = (B & this.maskGreen) >> ns[1];\n      var red = (B & this.maskRed) >> ns[2];\n\n      var location = line * this.width * 4 + x * 4;\n\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit24 = function() {\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n    for (var x = 0; x < this.width; x++) {\n      //Little Endian rgb\n      var blue = this.buffer.getUint8(this.pos++);\n      var green = this.buffer.getUint8(this.pos++);\n      var red = this.buffer.getUint8(this.pos++);\n      var location = line * this.width * 4 + x * 4;\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += this.width % 4;\n  }\n};\n\n/**\n * add 32bit decode func\n * @author soubok\n */\nBmpDecoder.prototype.bit32 = function() {\n  //BI_BITFIELDS\n  if (this.compress == 3) {\n    this.maskRed = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.maskGreen = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.maskBlue = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    this.mask0 = this.buffer.getUint32(this.pos, true);\n    this.pos += 4;\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n      for (var x = 0; x < this.width; x++) {\n        //Little Endian rgba\n        var alpha = this.buffer.getUint8(this.pos++);\n        var blue = this.buffer.getUint8(this.pos++);\n        var green = this.buffer.getUint8(this.pos++);\n        var red = this.buffer.getUint8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n        this.data[location] = alpha;\n        this.data[location + 1] = blue;\n        this.data[location + 2] = green;\n        this.data[location + 3] = red;\n      }\n    }\n  } else {\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n      for (var x = 0; x < this.width; x++) {\n        //Little Endian argb\n        var blue = this.buffer.getUint8(this.pos++);\n        var green = this.buffer.getUint8(this.pos++);\n        var red = this.buffer.getUint8(this.pos++);\n        var alpha = this.buffer.getUint8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n        this.data[location] = alpha;\n        this.data[location + 1] = blue;\n        this.data[location + 2] = green;\n        this.data[location + 3] = red;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.getData = function() {\n  return this.data;\n};\n","import PNG from './png.js';\nimport BMP from './bmp.js';\nimport { toRGB332 } from './colour.js';\n\nconst p = 16; // 16x16 sprite\n\nconst pngSig = [137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82];\n\nconst bmpSig = [66, 77];\n\nexport function decode(file) {\n  const { isPNG, isBMP } = detect(file);\n\n  if (isPNG) {\n    return png(file);\n  }\n\n  if (isBMP) {\n    return bmp(file);\n  }\n\n  return file;\n}\n\nexport function detect(file) {\n  let isPNG = true;\n  let isBMP = true;\n  for (let i = 0; i < Math.max(pngSig.length, bmpSig.length); i++) {\n    if (file[i] !== bmpSig[i]) {\n      isBMP = false;\n    }\n    if (file[i] !== pngSig[i]) {\n      isPNG = false;\n      break;\n    }\n  }\n\n  return { isPNG, isBMP };\n}\n\nexport function bmp(file) {\n  const bmp = new BMP(file);\n  const pixels = bmp.data;\n  return transform({ pixels, width: bmp.width, alphaFirst: true });\n}\n\nexport function pngNoTransformFile(file) {\n  const png = new PNG(file);\n  const pixels = png.decode();\n  const res = [];\n  for (let i = 0; i < pixels.length; i += 4) {\n    const [r, g, b, a] = [\n      pixels[i + 0],\n      pixels[i + 1],\n      pixels[i + 2],\n      pixels[i + 3],\n    ];\n\n    if (a === 0 || r === undefined) {\n      // transparent\n      res.push(0xe3);\n    } else {\n      res.push(toRGB332(r, g, b));\n    }\n  }\n\n  return { data: new Uint8Array(res), png };\n}\n\nexport function png(file) {\n  const png = new PNG(file);\n  const pixels = png.decode();\n  return transform({ pixels, width: png.width });\n}\n\nexport function transform({ pixels, width, alphaFirst = false }) {\n  // let tmp = null;\n\n  const res = [];\n\n  let [ri, gi, bi, ai] = [0, 1, 2, 3];\n  if (alphaFirst) {\n    [ai, bi, gi, ri] = [0, 1, 2, 3];\n  }\n\n  let n = 1;\n\n  if (width / 16 === ((width / 16) | 0)) {\n    n = width / 16;\n  } else {\n    // throw new Error('unsupported dimension');\n    const d = width % 16;\n    n = (width + (16 - d)) / 16;\n  }\n\n  for (let i = 0; i < pixels.length; i += 4) {\n    const row = ((i / 4 / p) | 0) % p;\n    const offset = (i / 4) % p;\n    const spriteIndex = (i / 4 / (p * p)) | 0;\n\n    const spriteRow = ((spriteIndex / n) | 0) * (p * p * n);\n    let dataIndex = spriteRow;\n    dataIndex += spriteIndex * p;\n    dataIndex += row * width;\n    dataIndex += offset;\n    dataIndex *= 4;\n\n    // NOTE I don't fully understand how this works, but it does after\n    // lots of testing...\n    dataIndex -= p * 4 * ((spriteIndex / n) | 0) * n;\n\n    const [r, g, b, a] = [\n      pixels[dataIndex + ri],\n      pixels[dataIndex + gi],\n      pixels[dataIndex + bi],\n      pixels[dataIndex + ai],\n    ];\n\n    if (a === 0 || r === undefined) {\n      // transparent\n      res.push(0xe3);\n    } else {\n      res.push(toRGB332(r, g, b));\n    }\n  }\n\n  return new Uint8Array(res);\n}\n","class ArrayNode extends Array {\n  constructor() {\n    super();\n\n    // allow setting any node property via proxy\n    return new Proxy(this, {\n      set(obj, prop, value) {\n        const type = obj[0];\n\n        if (type && prop in type) {\n          return obj.filter(el => (el[prop] = value));\n        }\n\n        const res = (this[prop] = value);\n        return res;\n      },\n    });\n  }\n\n  on(event, handler, options) {\n    return this.filter(el => el.addEventListener(event, handler, options));\n  }\n\n  emit(type, data) {\n    const event = new Event(type, { data });\n    return this.filter(el => el.dispatchEvent(event));\n  }\n}\n\nexport const $ = (s, ctx = document) => {\n  const res = ctx.querySelectorAll(s);\n\n  if (res.length === 0) {\n    console.warn(`${s} zero results`);\n  }\n\n  return ArrayNode.from(res);\n};\n","import { rgbFromIndex, transparent, toRGB332 } from './lib/colour.js';\n\nconst pixelLength = 256;\nconst width = 16;\n\nexport const colourTable = Array.from({ length: pixelLength }, (_, i) => {\n  return rgbFromIndex(i);\n});\n\nexport function getCoords(e, w = width, h = w) {\n  const rect = e.target.getBoundingClientRect();\n  const x = ((e.clientX - rect.left) / w) | 0; //x position within the element.\n  const y = ((e.clientY - rect.top) / h) | 0; //y position within the element.\n  const index = xyToIndex({ x, y, w: 16 });\n  return { x, y, index };\n}\n\nexport function emptyCanvas(ctx) {\n  const blankData = new Uint8ClampedArray(\n    ctx.canvas.width * ctx.canvas.height * 4\n  );\n  // blankData.fill(transparent);\n  for (let i = 0; i < blankData.length; i += 4) {\n    blankData[i + 0] = 0;\n    blankData[i + 1] = 0;\n    blankData[i + 2] = 0;\n    blankData[i + 3] = 0;\n  }\n\n  const blank = new ImageData(blankData, ctx.canvas.width, ctx.canvas.height);\n  ctx.putImageData(blank, 0, 0);\n}\n\nexport function xyToIndex({ x, y, w = width }) {\n  if (x < 0) {\n    return null;\n  }\n\n  if (x >= w) {\n    return null;\n  }\n\n  if (y >= w) {\n    return null;\n  }\n\n  return w * y + x;\n}\n\nexport class Sprite {\n  scale = 16;\n\n  /**\n   *\n   * @param {Uint8Array} pixels\n   */\n  constructor(pixels) {\n    this.pixels = pixels;\n    this.ctx = document.createElement('canvas').getContext('2d');\n    this.ctx.canvas.width = this.ctx.canvas.height = width;\n    this.render();\n  }\n\n  get canvas() {\n    return this.ctx.canvas;\n  }\n\n  pget({ index = null, x = null, y }) {\n    if (index === null) {\n      index = xyToIndex({ x, y });\n    }\n\n    return this.pixels[index];\n  }\n\n  pset({ index = null, x = null, y, value }) {\n    if (index === null) {\n      index = xyToIndex({ x, y });\n    }\n\n    this.pixels[index] = value;\n    this.render();\n  }\n\n  clear() {\n    this.pixels.fill(transparent);\n    this.render();\n  }\n\n  canvasToPixels() {\n    const imageData = this.ctx.getImageData(0, 0, width, width);\n    for (let i = 0; i < imageData.data.length / 4; i++) {\n      const [r, g, b, a] = imageData.data.slice(i * 4, i * 4 + 4);\n\n      if (a === 0) {\n        this.pixels[i] = transparent;\n      } else {\n        this.pixels[i] = toRGB332(r, g, b);\n      }\n    }\n  }\n\n  render(dx = 0, dy = 0) {\n    const pixels = this.pixels;\n\n    // imageData is the internal copy\n    const imageData = this.ctx.getImageData(0, 0, width, width);\n\n    for (let i = 0; i < pixels.length; i++) {\n      let index = pixels[i];\n      const { r, g, b, a } = colourTable[index];\n      imageData.data[i * 4 + 0] = r;\n      imageData.data[i * 4 + 1] = g;\n      imageData.data[i * 4 + 2] = b;\n      imageData.data[i * 4 + 3] = a * 255;\n    }\n\n    if (dx !== 0 || dy !== 0) {\n      emptyCanvas(this.ctx);\n    }\n\n    this.ctx.putImageData(\n      imageData,\n      dx,\n      dy,\n      0,\n      0,\n      imageData.width,\n      imageData.height\n    );\n  }\n\n  // we always paint square\n  paint(ctx, dx = 0, dy = 0, w = null) {\n    if (w === null) {\n      w = ctx.canvas.width;\n    }\n    // clear, set to jaggy and scale to canvas\n    ctx.clearRect(dx, dy, w, w);\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(\n      this.ctx.canvas,\n      0,\n      0,\n      this.ctx.canvas.width,\n      this.ctx.canvas.height,\n      dx,\n      dy,\n      w,\n      w\n    );\n  }\n}\n\nexport default class SpriteSheet {\n  sprites = [];\n  previewCtx = [];\n  history = [];\n  ctx = null;\n  _undoPtr = 0;\n  _current = 0;\n  length = 0;\n  clipboard = null;\n  hooks = [];\n\n  constructor(data, ctx, scale = 2) {\n    this.data = new Uint8Array(pixelLength * 4 * 16);\n    this.data.set(data.slice(0, pixelLength * 4 * 16), 0);\n\n    for (let i = 0; i < this.data.length; i += pixelLength) {\n      const spriteData = this.data.subarray(i, i + pixelLength);\n      const sprite = new Sprite(spriteData);\n      this.sprites.push(sprite);\n\n      const ctx = document.createElement('canvas').getContext('2d');\n      ctx.canvas.width = ctx.canvas.height = width * scale;\n      this.previewCtx.push(ctx);\n      sprite.paint(ctx);\n    }\n\n    this.snapshot();\n    this.length = data.length / pixelLength;\n    this._current = 0;\n    this.scale = scale;\n    this.ctx = ctx;\n\n    window.sprites = this;\n  }\n\n  getCoords(e) {\n    return getCoords(e, this.scale * 16);\n  }\n\n  hook(callback) {\n    this.hooks.push(callback);\n  }\n\n  trigger() {\n    this.hooks.forEach(callback => callback());\n  }\n\n  copy() {\n    // FIXME support partial copy/clip //{ x = 0, y = 0, w = width, h = width }\n    this.clipboard = new Sprite(new Uint8Array(this.sprite.pixels));\n  }\n\n  paste() {\n    if (this.clipboard.pixels) this.set(this.clipboard.pixels);\n  }\n\n  set(data) {\n    // FIXME support partial paste\n    this.snapshot();\n    this.data.set(data, this._current * pixelLength);\n    this.rebuild(this._current);\n    this.paint();\n  }\n\n  snapshot() {\n    this.history.splice(this._undoPtr + 1);\n    this.history.push(new Uint8Array(this.data));\n    this._undoPtr = this.history.length - 1;\n    console.log(`history: ${this.history.length}`);\n  }\n\n  undo() {\n    const data = this.history[this._undoPtr];\n\n    if (!data) {\n      return;\n    }\n    this._undoPtr--;\n\n    this.data = data;\n    for (let i = 0; i < this.length; i++) {\n      this.rebuild(i);\n    }\n    this.paint();\n  }\n\n  rebuild(i) {\n    if (i < 0 || i > this.length) {\n      return; // noop\n    }\n    const sprite = new Sprite(\n      this.data.subarray(i * pixelLength, i * pixelLength + pixelLength)\n    );\n    this.sprites[i] = sprite;\n    sprite.paint(this.previewCtx[i]);\n    this.trigger();\n  }\n\n  getPreviewElements() {\n    return this.previewCtx.map(_ => _.canvas);\n  }\n\n  canvasToPixels() {\n    this.sprites[this._current].canvasToPixels();\n  }\n\n  pset(coords, value) {\n    this.sprites[this._current].pset({ ...coords, value });\n    this.trigger();\n    return true;\n  }\n\n  pget(args) {\n    return this.sprites[this._current].pget(args);\n  }\n\n  get current() {\n    return this._current;\n  }\n\n  get sprite() {\n    return this.sprites[this._current];\n  }\n\n  set current(value) {\n    this._current = value;\n    this.paint();\n  }\n\n  get(index) {\n    return this.sprites[index];\n  }\n\n  clear() {\n    this.snapshot();\n    this.sprites[this._current].clear();\n    this.trigger();\n    this.paint();\n  }\n\n  renderPreview(i) {\n    this.sprites[i].draw(this.previewCtx[i]);\n  }\n\n  paint(i = this._current) {\n    const sprite = this.sprites[i];\n    sprite.paint(this.ctx);\n    sprite.paint(this.previewCtx[this._current]);\n\n    this.getPreviewElements().map(_ => _.classList.remove('focus'));\n    this.previewCtx[this._current].canvas.classList.add('focus');\n  }\n}\n","const noop = () => {};\n\nexport default function trackDown(\n  el,\n  { handler = noop, move = noop, start = noop, end = noop }\n) {\n  let down = false;\n\n  el.addEventListener('mouseout', () => (down = false));\n  el.addEventListener('click', handler);\n  el.addEventListener(\n    'mousedown',\n    e => {\n      start(e);\n      down = true;\n    },\n    true\n  );\n  el.addEventListener(\n    'mouseup',\n    e => {\n      down = false;\n      end(e);\n    },\n    true\n  );\n  el.addEventListener(\n    'mousemove',\n    e => {\n      if (down) {\n        handler(e);\n      } else {\n        move(e);\n      }\n    },\n    true\n  );\n\n  return () => {\n    down = false;\n  };\n}\n","import { $ } from '../lib/$.js';\nimport { colourTable, emptyCanvas, getCoords } from './SpriteSheet.js';\nimport trackDown from '../lib/track-down.js';\nimport { toRGB332 } from './lib/colour.js';\n\nexport default class ImageWindow {\n  zoomFactor = 0;\n  x = 0;\n  y = 0;\n\n  constructor(data, ctx, width, height) {\n    this.ctx = ctx;\n    this.__ctx = document.createElement('canvas').getContext('2d');\n    this.__ctx.canvas.width = width;\n    this.__ctx.canvas.height = height;\n    this.parent = ctx.canvas.parentNode;\n    this.status = $('#png-status');\n\n    trackDown(ctx.canvas, {\n      start: (e) => this.start(e),\n      handler: (e) => this.pan(e),\n      end: (e) => this.end(e),\n    });\n\n    this.render(this.__ctx, data);\n    this.zoom = 0;\n  }\n\n  get zoom() {\n    return this.zoomFactor;\n  }\n\n  set zoom(value) {\n    const preZoomDelta = this.zoomDelta;\n    this.zoomFactor = value;\n    if (this.zoomFactor > 4) {\n      this.zoomFactor = 4;\n    }\n\n    if (this.zoomFactor < -3) {\n      this.zoomFactor = -3;\n    }\n\n    this.parent.dataset.zoom = this.zoomFactor;\n\n    const delta = this.zoomDelta - preZoomDelta;\n    this.x += delta;\n    this.y += delta;\n\n    this.paint();\n  }\n\n  get pxScale() {\n    if (this.zoomFactor >= 3) {\n      return 1;\n    }\n    return 16 / (this.zoomFactor + 1) / 2;\n  }\n\n  get zoomDelta() {\n    return (0xff >> (this.zoomFactor + 3)) << 3;\n  }\n\n  coords(x = this.x, y = this.y) {\n    const delta = this.zoomDelta;\n    return {\n      x: Math.abs(x - delta),\n      y: Math.abs(y - delta),\n    };\n  }\n\n  start(event) {\n    const coords = getCoords(event, this.pxScale);\n    this.parent.dataset.dragging = true;\n    this._coords = {\n      x: coords.x,\n      y: coords.y,\n      curX: this.x,\n      curY: this.y,\n    };\n  }\n\n  end(event) {\n    this.parent.dataset.dragging = false;\n    const scale = this.pxScale;\n    const coords = getCoords(event, scale);\n    this.x = (this._coords.curX + (coords.x - this._coords.x) * scale) | 0;\n    this.y = (this._coords.curY + (coords.y - this._coords.y) * scale) | 0;\n\n    this.paint();\n  }\n\n  shiftX(neg = false, n = 1) {\n    this.x += neg ? -n : n;\n    this.paint();\n  }\n\n  shiftY(neg = false, n = 1) {\n    this.y += neg ? -n : n;\n    this.paint();\n  }\n\n  pan(event) {\n    if (event.type === 'click') {\n      return;\n    }\n    const scale = this.pxScale;\n    const coords = getCoords(event, scale);\n    const x = this.x + (coords.x - this._coords.x) * scale;\n    const y = this.y + (coords.y - this._coords.y) * scale;\n    this.paint(x | 0, y | 0);\n  }\n\n  copy() {\n    const data = new Uint8Array(16 * 16);\n    const ctx = this.__ctx;\n\n    const { x, y } = this.coords();\n\n    const imageData = ctx.getImageData(x, y, 16, 16);\n\n    for (let i = 0; i < data.length; i++) {\n      const [r, g, b, a] = imageData.data.slice(i * 4, i * 4 + 4);\n      const index = toRGB332(r, g, b);\n      if (index === 0xe3 || a === 0) {\n        data[i] = 0xe3;\n      } else {\n        data[i] = index;\n      }\n    }\n\n    if (this.oncopy) this.oncopy(data);\n  }\n\n  paint(x = this.x, y = this.y) {\n    const zoom =\n      this.zoomFactor < 0\n        ? 512 << (this.zoomFactor * -1)\n        : 512 >> this.zoomFactor;\n\n    const localCords = this.coords(x, y);\n    this.status.innerHTML = `Zoom: ${5 - this.zoomFactor}:1<br>X/Y: ${\n      localCords.x\n    }/${localCords.y}`;\n    const ctx = this.ctx;\n    emptyCanvas(ctx);\n    const w = ctx.canvas.width;\n    ctx.clearRect(0, 0, w, w);\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(this.__ctx.canvas, -x, -y, zoom, zoom, 0, 0, w, w);\n  }\n\n  render(ctx = this.ctx, pixels) {\n    const imageData = ctx.getImageData(\n      0,\n      0,\n      ctx.canvas.width,\n      ctx.canvas.height\n    );\n\n    for (let i = 0; i < imageData.data.length / 4; i++) {\n      let index = pixels[i];\n      const { r, g, b, a } = colourTable[index];\n\n      imageData.data[i * 4 + 0] = r;\n      imageData.data[i * 4 + 1] = g;\n      imageData.data[i * 4 + 2] = b;\n      imageData.data[i * 4 + 3] = a * 255;\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n}\n","import { transparent } from './lib/colour.js';\n\nexport default class ColourPicker {\n  transparent = transparent;\n  _index = 0;\n  _history = [];\n\n  constructor(size, target) {\n    this.size = size;\n\n    const html = Array.from({ length: size }, (_, i) => {\n      return `<div title=\"Key ${i + 1}\" data-id=${i} id=\"picker-${i}\"></div>`;\n    }).join('');\n    target.innerHTML = html;\n\n    target.addEventListener('mousedown', e => {\n      if (e.target.dataset.id) {\n        this.index = e.target.dataset.id;\n      }\n    });\n\n    this.container = target;\n    this.history = [0, 255, this.transparent];\n    this.index = 0;\n  }\n\n  set value(index) {\n    const colour = parseInt(index, 10);\n\n    if (colour === this._history[0]) {\n      this.index = 0;\n      return;\n    }\n\n    this._history.unshift(colour);\n    this.history = this._history.slice(0, this.size);\n    this.index = 0;\n  }\n\n  set history(values) {\n    this._history = values;\n    values.forEach((value, i) => {\n      document.querySelector('#picker-' + i).className = 'c-' + value;\n    });\n  }\n\n  get value() {\n    return this._history[this._index];\n  }\n\n  set index(value) {\n    value = parseInt(value, 10);\n    this._index = value;\n    this.container.dataset.selected = value + 1;\n  }\n}\n","import { $ } from '../lib/$.js';\nimport { getCoords } from './SpriteSheet.js';\n\nexport default class Tool {\n  types = ['brush', 'fill', 'erase', 'pan'];\n  _selected = 'brush';\n  state = {\n    target: null,\n    index: null,\n  };\n\n  constructor({ type = 'brush', colour }) {\n    this.colour = colour;\n\n    $('#tool-types button').on('click', e => {\n      this.selected = e.target.dataset.action;\n    });\n\n    const shortcuts = this.types.map(_ => _[0]);\n\n    document.body.addEventListener('keydown', e => {\n      const k = e.key;\n      const i = shortcuts.indexOf(k);\n      if (i > -1) {\n        this.selected = this.types[i];\n      }\n    });\n\n    this.selected = type;\n  }\n\n  get selected() {\n    return this._selected;\n  }\n\n  set selected(value) {\n    this._selected = value;\n    this.state = { index: null, target: null };\n\n    $('#tool-types button').className = '';\n    $(`#tool-types button[data-action=\"${value}\"]`).className = 'selected';\n    document.documentElement.dataset.tool = value;\n  }\n\n  shift(shift) {\n    this.state.index = null;\n    if (shift) {\n      if (this._last !== 'erase') this._last = this.selected;\n      this.selected = 'erase';\n    } else if (this._last) {\n      this.selected = this._last;\n      this._last = null;\n    }\n  }\n\n  pan(coords, sprites) {\n    const sprite = sprites.sprite;\n    const ctx = sprites.ctx;\n    const x = coords.x - this._coords.x;\n    const y = coords.y - this._coords.y;\n\n    sprite.render(x, y);\n    sprite.paint(ctx);\n  }\n\n  fill(sprites, coords, source, target) {\n    if (!coords || coords.index === null) return;\n\n    const value = sprites.pget(coords);\n\n    if (value !== source || value === target) {\n      return;\n    }\n\n    this.paint(sprites, coords, target);\n\n    const { x, y } = coords;\n\n    this.fill(sprites, { x: x - 1, y }, source, target);\n    this.fill(sprites, { x: x + 1, y }, source, target);\n    this.fill(sprites, { x, y: y - 1 }, source, target);\n    this.fill(sprites, { x, y: y + 1 }, source, target);\n  }\n\n  paint(sprites, coords, target) {\n    return sprites.pset(coords, target);\n  }\n\n  start(event) {\n    const coords = getCoords(event);\n    this._coords = coords;\n  }\n\n  end() {\n    // this._coords = null;\n  }\n\n  apply(event, sprites) {\n    const coords = getCoords(event, 32, 32);\n    let target = this.colour.value;\n\n    if (this.selected === 'erase') {\n      target = this.colour.transparent;\n    }\n\n    // if nothing has changed, don't do the work\n    if (\n      event.type === this.state.event &&\n      coords.index === this.state.index &&\n      target === this.state.target\n    ) {\n      return;\n    }\n    this.state.index = coords.index;\n    this.state.target = target;\n    this.state.event = event.type;\n\n    if (this.selected === 'pan') {\n      if (event.type === 'click' && this._coords.index !== coords.index) {\n        // this is a release\n        // read from the canvas and put into pixels\n        sprites.snapshot();\n        sprites.canvasToPixels();\n        sprites.rebuild(sprites.current);\n        sprites.paint();\n        return;\n      }\n\n      if (!this._coords) {\n        return; // noop\n      }\n\n      this.pan(coords, sprites);\n\n      return;\n    }\n\n    if (this.selected === 'fill') {\n      // now find surrounding pixels of the same colour\n      this.fill(sprites, coords, sprites.pget(coords), target);\n    } else {\n      this.paint(sprites, coords, target);\n    }\n\n    // update canvas\n    if (event.type === 'click') sprites.snapshot();\n    sprites.paint();\n  }\n}\n","// import { rgbFromIndex, transparent, toRGB332 } from './lib/colour.js';\nimport { xyToIndex } from './SpriteSheet.js';\nimport { $ } from '../lib/$.js';\nimport trackDown from '../lib/track-down.js';\n\nconst dummySpriteSheet = {\n  get() {\n    return dummySpriteSheet;\n  },\n\n  paint() {},\n};\n\nexport function getCoords(e, w, size) {\n  const rect = e.target.getBoundingClientRect();\n  const x = ((e.clientX - rect.left) / size) | 0; //x position within the element.\n  const y = ((e.clientY - rect.top) / size) | 0; //y position within the element.\n  const index = xyToIndex({ x, y, w });\n  return { x, y, index };\n}\n\nconst sizes = new Map([\n  [16, { bank: 16 * 12, w: 16, h: 12 }],\n  [8, { bank: 32 * 24, w: 32, h: 24 }],\n]);\n\nexport default class TileMap {\n  scale = 3;\n  _sprites = null;\n  _tmp = null;\n\n  constructor({ size = 16, sprites }) {\n    const scale = this.scale;\n    this.size = size;\n    const { bank, w, h } = sizes.get(size);\n    this.width = w;\n    this.height = h;\n\n    this.bank = new Uint8Array(bank);\n    this.bank.fill(1024 / size - 1);\n\n    this.ctx = document.createElement('canvas').getContext('2d');\n\n    const el = this.ctx.canvas;\n    el.style.maxWidth = `${w * size * scale}px`;\n\n    el.width = w * size * scale;\n    el.height = h * size * scale;\n\n    const cancel = trackDown(el, {\n      handler: e => {\n        const { index } = getCoords(e, this.width, this.size * this.scale);\n        this.set(index);\n        this._tmp = null;\n        this.paint();\n      },\n      end: e => this.hover(e),\n    });\n\n    el.addEventListener('mouseout', () => {\n      cancel();\n      this.clearHover();\n    });\n\n    this.sprites = sprites;\n    this.active = true;\n  }\n\n  set active(value) {\n    $(`.tile-controls input[name=\"size\"][value=\"${this.size}\"]`).checked = true;\n    $(`.tile-controls input[name=\"width\"]`).value = this.width;\n    $(`.tile-controls input[name=\"height\"]`).value = this.height;\n  }\n\n  set sprites(sprites) {\n    this._sprites = sprites || dummySpriteSheet;\n    if (sprites) sprites.hook(() => this.paint());\n    this.paint();\n  }\n\n  get sprites() {\n    return this._sprites;\n  }\n\n  getXY = i => {\n    const x = i % this.width;\n    const y = (i / this.width) | 0;\n\n    return { x, y };\n  };\n\n  set(index) {\n    this.bank[index] = this.sprites.current;\n  }\n\n  clearHover() {\n    if (this._tmp !== null) {\n      const index = this._tmp;\n      const { x, y } = this.getXY(index);\n      // if (this.bank[index] === -1) {\n      //   this.ctx.clearRect(\n      //     x * this.size * this.scale,\n      //     y * this.size * this.scale,\n      //     this.size * this.scale,\n      //     this.size * this.scale\n      //   );\n      // } else {\n      const sprite = this.sprites.get(this.bank[index]);\n\n      sprite.paint(\n        this.ctx,\n        x * this.size * this.scale,\n        y * this.size * this.scale,\n        this.size * this.scale,\n        false\n      );\n      // }\n      this._tmp = null;\n    }\n  }\n\n  hover(e) {\n    const { index, x, y } = getCoords(e, this.width, this.size * this.scale);\n\n    if (this._tmp === index) {\n      return;\n    }\n\n    this.clearHover();\n\n    this._tmp = index;\n    this.sprites.sprite.paint(\n      this.ctx,\n      x * this.size * this.scale,\n      y * this.size * this.scale,\n      this.size * this.scale,\n      false\n    );\n  }\n\n  paint() {\n    for (let i = 0; i < this.bank.length; i++) {\n      // if (this.bank[i] > -1) {\n      const { x, y } = this.getXY(i);\n      const sprite = this.sprites.get(this.bank[i]);\n      sprite.paint(\n        this.ctx,\n        x * this.size * this.scale,\n        y * this.size * this.scale,\n        this.size * this.scale,\n        false\n      );\n      // }\n    }\n  }\n}\n","// https://en.wikipedia.org/wiki/ZX_Spectrum_character_set\nexport default {\n  // 0x3a: ':',\n  // 0x2a: '*',\n  0x87: 'PEEK$',\n  0x88: 'REG',\n  0x89: 'DPOKE',\n  0x8a: 'DPEEK',\n  0x8b: 'MOD',\n  0x8c: '<<',\n  0x8d: '>>',\n  0x8e: 'UNTIL',\n  0x8f: 'ERROR',\n  0x90: 'ON',\n  0x91: 'DEFPROC',\n  0x92: 'ENDPROC',\n  0x93: 'PROC',\n  0x94: 'LOCAL',\n  0x95: 'DRIVER',\n  0x96: 'WHILE',\n  0x97: 'REPEAT',\n  0x98: 'ELSE',\n  0x99: 'REMOUNT',\n  0x9a: 'BANK',\n  0x9b: 'TILE',\n  0x9c: 'LAYER',\n  0x9d: 'PALETTE',\n  0x9e: 'SPRITE',\n  0x9f: 'PWD',\n  0xa0: 'CD',\n  0xa1: 'MKDIR',\n  0xa2: 'RMDIR',\n  0xa3: 'SPECTRUM',\n  0xa4: 'PLAY',\n  0xa5: 'RND',\n  0xa6: 'INKEY$',\n  0xa7: 'PI',\n  0xa8: 'FN',\n  0xa9: 'POINT',\n  0xaa: 'SCREEN$',\n  0xab: 'ATTR',\n  0xac: 'AT',\n  0xad: 'TAB',\n  0xae: 'VAL$',\n  0xaf: 'CODE',\n  0xb0: 'VAL',\n  0xb1: 'LEN',\n  0xb2: 'SIN',\n  0xb3: 'COS',\n  0xb4: 'TAN',\n  0xb5: 'ASN',\n  0xb6: 'ACS',\n  0xb7: 'ATN',\n  0xb8: 'LN',\n  0xb9: 'EXP',\n  0xba: 'INT',\n  0xbb: 'SQR',\n  0xbc: 'SGN',\n  0xbd: 'ANS',\n  0xbe: 'PEEK',\n  0xbf: 'IN',\n  0xc0: 'USR',\n  0xc1: 'STR$',\n  0xc2: 'CHR$',\n  0xc3: 'NOT',\n  0xc4: 'BIN',\n  0xc5: 'OR',\n  0xc6: 'AND',\n  0xc7: '<=',\n  0xc8: '>=',\n  0xc9: '<>',\n  0xca: 'LINE',\n  0xcb: 'THEN',\n  0xcc: 'TO',\n  0xcd: 'STEP',\n  0xce: 'DEF FN',\n  0xcf: 'CAT',\n  0xd0: 'FORMAT',\n  0xd1: 'MOVE',\n  0xd2: 'ERASE',\n  0xd3: 'OPEN#',\n  0xd4: 'CLOSE#',\n  0xd5: 'MERGE',\n  0xd6: 'VERIFY',\n  0xd7: 'BEEP',\n  0xd8: 'CIRCLE',\n  0xd9: 'INK',\n  0xda: 'PAPER',\n  0xdb: 'FLASH',\n  0xdc: 'BRIGHT',\n  0xdd: 'INVERSE',\n  0xde: 'OVER',\n  0xdf: 'OUT',\n  0xe0: 'LPRINT',\n  0xe1: 'LLIST',\n  0xe2: 'STOP',\n  0xe3: 'READ',\n  0xe4: 'DATA',\n  0xe5: 'RESTORE',\n  0xe6: 'NEW',\n  0xe7: 'BORDER',\n  0xe8: 'CONTINUE',\n  0xe9: 'DIM',\n  0xea: 'REM',\n  0xeb: 'FOR',\n  0xec: 'GO TO',\n  0xed: 'GO SUB',\n  0xee: 'INPUT',\n  0xef: 'LOAD',\n  0xf0: 'LIST',\n  0xf1: 'LET',\n  0xf2: 'PAUSE',\n  0xf3: 'NEXT',\n  0xf4: 'POKE',\n  0xf5: 'PRINT',\n  0xf6: 'PLOT',\n  0xf7: 'RUN',\n  0xf8: 'SAVE',\n  0xf9: 'RANDOMIZE',\n  0xfa: 'IF',\n  0xfb: 'CLS',\n  0xfc: 'DRAW',\n  0xfd: 'CLEAR',\n  0xfe: 'RETURN',\n  0xff: 'COPY',\n};\n","export const toBinary = (n, size = 8) => {\n  if (n < 0) {\n    return Array.from({ length: size }, (_, i) => {\n      return ((n >> i) & 1) === 1 ? 1 : 0;\n    })\n      .reverse()\n      .join('');\n  }\n  return n.toString(2).padStart(size, 0);\n};\n\nexport const toHex = (n, size = 8) => {\n  if (n < 0) {\n    n = parseInt(toBinary(n, size), 2);\n  }\n  return n\n    .toString(16)\n    .padStart(size / (8 / 2), 0)\n    .toUpperCase();\n};\n\n// https://www.facebook.com/groups/ZXNextBasic/permalink/792585537934454/?comment_id=792727721253569\n// by Daniel A. Nagy originally in C, bless his socks\nexport const floatToZX = input => {\n  const sign = input < 0;\n  const out = new Uint8Array(5);\n\n  if (sign) input = -input;\n\n  out[0] = 0x80;\n  while (input < 0.5) {\n    input *= 2;\n    out[0]--;\n  }\n\n  while (input >= 1) {\n    input *= 0.5;\n    out[0]++;\n  }\n\n  input *= 0x100000000;\n  input += 0.5;\n\n  let mantissa = input;\n\n  out[1] = mantissa >> 24;\n  mantissa &= 0xffffff;\n  out[2] = mantissa >> 16;\n  mantissa &= 0xffff;\n  out[3] = mantissa >> 8;\n  mantissa &= 0xff;\n  out[4] = mantissa;\n  if (!sign) out[1] &= 0x7f;\n\n  return out;\n};\n\nexport const zxToFloat = source => {\n  const view = new DataView(source.buffer);\n  const exp = view.getUint8(0) - 128;\n  let mantissa = view.getUint32(1, false);\n  let sign = mantissa >>> 31 ? -1 : 1;\n\n  mantissa = mantissa | 0x80000000;\n  let frac = 0;\n  for (let i = 0; i < 32; i++) {\n    if ((mantissa >> i) & 1) {\n      const v = Math.pow(2, -(32 - i));\n      frac += v;\n    }\n  }\n\n  frac = frac.toFixed(8);\n\n  const value = frac * Math.pow(2, exp);\n  return value * sign;\n};\n","export const pattern =\n  '([aAZbBhHcCWqQnNvVuUx@]|[sSlLiI][\\\\!><]?)(?:([\\\\d*]+)|(?:\\\\[(.*)\\\\]))?(?:\\\\$([a-zA-Z0-9_]+)\\\\b)?';\nexport const typeMap = {\n  x: { length: 1 },\n  b: { length: 1 },\n  //B: { length: 1, fn: 'Uint8', little: true }, // bit\n  // h: { length: 2, fn: 'Uint16' },\n  // H: { length: 2, fn: 'Uint16', little: true }, // nibble\n  c: { length: 1, fn: 'Int8', array: Int8Array }, // char == byte\n  C: { length: 1, fn: 'Uint8', array: Uint8Array },\n  a: { length: 1, fn: 'Uint8' }, // string with arbitrary, null padded\n  A: { length: 1, fn: 'Uint8' }, // string with arbitrary, space padded\n  s: { length: 2, fn: 'Int16', array: Int16Array },\n  S: { length: 2, fn: 'Uint16', array: Uint16Array },\n  i: { length: 4, fn: 'Int32', array: Int32Array },\n  I: { length: 4, fn: 'Uint32', array: Uint32Array },\n  l: { length: 8, fn: 'Int64' },\n  L: { length: 8, fn: 'Uint64' },\n  n: { length: 2, fn: 'Uint16', little: false },\n  N: { length: 4, fn: 'Uint32', little: false },\n  f: { length: 4, fn: 'Float32', array: Float32Array },\n  d: { length: 8, fn: 'Float64', array: Float64Array },\n};\n\nexport const decode = a => new TextDecoder().decode(a);\nexport const encode = a => new TextEncoder().encode(a);\n","import { encode, pattern, typeMap } from './lib.js';\n\nexport default function pack(template, data, offset = 0) {\n  if (ArrayBuffer.isView(data)) {\n    data = data.buffer;\n  }\n\n  const re = new RegExp(pattern, 'g');\n  let m = [];\n  let bytePtr = 0;\n  let little = false;\n\n  const firstChr = template[0];\n  const defaultLittle = firstChr === '<' ? true : false;\n\n  let templateCounter = -1;\n\n  let dataLength = 0;\n\n  while ((m = re.exec(template))) {\n    let length = null;\n    if (typeMap[m[2]]) {\n      length = typeMap[m[2]].length;\n    } else {\n      length = parseInt(m[2] || 1);\n    }\n\n    let c = m[1];\n\n    if (c.length === 2) {\n      little = c[1] === '<';\n      c = c[0];\n    }\n\n    const type = typeMap[c];\n\n    if (!type) {\n      throw new Error(`unsupported type \"${c}\"`);\n    }\n\n    const size = type.length;\n    let end = c === 'b' ? length / 8 : size * length;\n\n    if (isNaN(length)) {\n      end = data.byteLength - offset;\n    }\n\n    dataLength += end; // ?\n  }\n\n  const result = new DataView(new ArrayBuffer(dataLength));\n\n  while ((m = re.exec(template))) {\n    templateCounter++;\n    const index = m[4] || templateCounter;\n    let little = defaultLittle;\n    let length = null;\n    if (typeMap[m[2]]) {\n      length = typeMap[m[2]].length;\n    } else {\n      length = parseInt(m[2] || 1);\n    }\n\n    let c = m[1];\n\n    if (c.length === 2) {\n      little = c[1] === '<';\n      c = c[0];\n    }\n\n    const type = typeMap[c];\n\n    if (!type) {\n      throw new Error(`unsupported type \"${c}\"`);\n    }\n\n    // forced endianness\n    if (type.little !== undefined) {\n      little = type.little;\n    }\n\n    const size = type.length;\n    let end = c === 'b' ? 1 : size * length;\n\n    if (isNaN(length)) {\n      end = data.byteLength - offset;\n    }\n\n    if (offset + end > data.byteLength) {\n      // return result;\n      break;\n    }\n\n    if (c !== 'b') {\n      // reset the byte counter\n      bytePtr = 0;\n    }\n\n    switch (c) {\n      case 'b':\n        result.setUint8(\n          offset,\n          result.getUint8(offset) | (data[index] << (8 - bytePtr - length))\n        );\n\n        bytePtr += length;\n        if (bytePtr > 7) {\n          offset++;\n          bytePtr = 0;\n        }\n\n        break;\n      case 'x':\n        // x is skipped null bytes\n        templateCounter--;\n        offset += end;\n        result.setUint8(offset, 0x00);\n        break;\n      case 'a':\n      case 'A':\n        new Uint8Array(result.buffer, offset, end).set(encode(data[index]));\n        offset += end;\n        break;\n      default:\n        if (length > 1) {\n          for (let i = index; i < index + length; i++) {\n            result[`set${type.fn}`](offset, data[i], little);\n            templateCounter++;\n            offset += type.length;\n          }\n        } else {\n          result[`set${type.fn}`](offset, data[index], little);\n        }\n        offset += end;\n        break;\n    }\n  }\n\n  return new Uint8Array(result.buffer);\n}\n","import codes from './codes.js';\nimport { floatToZX } from '../lib/to.js';\nimport pack from '../lib/unpack/pack.js';\n\nexport const encode = a => new TextEncoder().encode(a);\n\nexport const calculateXORChecksum = array =>\n  Uint8Array.of(array.reduce((checksum, item) => checksum ^ item, 0))[0];\n\nconst opTable = Object.entries(codes).reduce(\n  (acc, [code, str]) => {\n    acc[str] = parseInt(code);\n    return acc;\n  },\n  {\n    GOTO: 0xec,\n  }\n);\n\n/*\nheader unpack template:\n<S$headerLength\nC$flagByte\nC$type\nA10$filename\nS$length\nS$autostart\nS$varStart\nC$checksum\n\nS$nextBlockLength\n\nC$blockType\nC$data\nC$blockChecksum\n*/\n\nexport const tapHeader = (basic, filename = 'BASIC') => {\n  const autostart = new DataView(basic.buffer).getUint16(0, false);\n  const res = pack(\n    '<S$headerLength C$flagByte C$type A10$filename S$length S$p1 S$p2 C$checksum',\n    {\n      headerLength: 19,\n      flagByte: 0x0, // header\n      type: 0x00, // program\n      filename: filename.slice(0, 10), // 10 chrs max\n      length: basic.length,\n      p1: autostart,\n      p2: basic.length,\n      checksum: 0, // solved later\n    }\n  );\n\n  const checksum = calculateXORChecksum(res.slice(2, 20));\n\n  res[res.length - 1] = checksum;\n\n  return res;\n};\n\nexport const asTap = (basic, filename = 'tap dot js') => {\n  const header = tapHeader(basic, filename);\n  const dataType = 0xff;\n  const checksum = calculateXORChecksum(Array.from([dataType, ...basic]));\n  const tapData = new Uint8Array(header.length + basic.length + 2 + 2); // ? [header.length, basic.length]\n  tapData.set(header, 0); // put header in tap\n  new DataView(tapData.buffer).setUint16(header.length, basic.length + 2, true); // set follow block length (plus 2 for flag + checksum)\n\n  tapData[header.length + 2] = dataType; // data follows\n  tapData.set(basic, header.length + 3); // put basic binary in tap\n  tapData[tapData.length - 1] = checksum; // finish with 8bit checksum\n\n  return tapData;\n};\n\nexport const plus3DOSHeader = (\n  basic,\n  opts = { hType: 0, hOffset: basic.length - 128 }\n) => {\n  const { hType, hOffset } = opts;\n  const res = pack(\n    '< A8$sig C$eof C$issue C$version I$length C$hType S$hFileLength n$hLine S$hOffset',\n    {\n      sig: 'PLUS3DOS',\n      eof: 26,\n      issue: 1,\n      version: 0,\n      length: basic.length,\n      hType,\n      hFileLength: basic.length - 128,\n      hLine: 128,\n      hOffset,\n    }\n  );\n\n  const checksum = Array.from(res).reduce((acc, curr) => (acc += curr), 0);\n\n  const result = new Uint8Array(128);\n  result.set(res, 0);\n  result[127] = checksum;\n\n  return result;\n};\n\n// Based on (with huge mods) https://eli.thegreenplace.net/2013/07/16/hand-written-lexer-in-javascript-compared-to-the-regex-based-ones\nexport default class Lexer {\n  pos = 0;\n  buf = null;\n  bufLen = 0;\n\n  // Operator table, mapping operator -> token name\n  opTable = opTable;\n\n  // Initialize the Lexer's buffer. This resets the lexer's internal\n  // state and subsequent tokens will be returned starting with the\n  // beginning of the new buffer.\n  input(buf) {\n    this.pos = 0;\n    this.buf = buf;\n    this.bufLen = buf.length;\n  }\n\n  lines(lines) {\n    const data = lines.split('\\n').map(line => this.line(line).basic);\n    const len = data.reduce((acc, curr) => (acc += curr.length), 0);\n    const res = new Uint8Array(len);\n    let offset = 0;\n    data.forEach(line => {\n      res.set(line, offset);\n      offset += line.length;\n    });\n    return res;\n  }\n\n  // TODO arrays\n  line(line) {\n    this.input(line);\n    this.inLiteral = false;\n    let lineNumber = null;\n    let tokens = [];\n    let length = 0;\n\n    let token = null;\n    while ((token = this.token())) {\n      const { name, value } = token;\n      if (!lineNumber && name === 'NUMBER') {\n        lineNumber = parseInt(value, 10);\n        continue;\n      }\n\n      if (name === 'KEYWORD') {\n        length++;\n        tokens.push(token);\n        if (codes[value] === 'REM') {\n          token = this._processComment();\n          length += token.value.length;\n          tokens.push(token);\n        }\n        if (codes[value] === 'BIN') {\n          token = this._processBinary(); // ?\n          length += token.value.length;\n          tokens.push(token);\n        }\n      } else if (name === 'NUMBER') {\n        length += value.toString().length;\n        const { numeric } = token;\n        tokens.push(token);\n\n        if (\n          (numeric | 0) === numeric &&\n          numeric >= -65535 &&\n          numeric <= 65535\n        ) {\n          const view = new DataView(new ArrayBuffer(6));\n          view.setUint8(0, 0x0e);\n          view.setUint8(1, 0x00);\n          view.setUint8(2, numeric < 0 ? 0xff : 0x00);\n          view.setUint16(3, numeric, true);\n          tokens.push({\n            name: 'NUMBER_DATA',\n            value: new Uint8Array(view.buffer),\n          });\n          length += 6;\n        } else {\n          const value = new Uint8Array(6);\n          value[0] = 0x0e;\n          value.set(floatToZX(numeric), 1);\n          tokens.push({\n            name: 'NUMBER_DATA',\n            value,\n          });\n          length += 6;\n        }\n      } else {\n        length += value.toString().length;\n        tokens.push(token);\n      }\n    }\n\n    // add the end of carriage to the line\n    tokens.push({ name: 'KEYWORD', value: 0x0d });\n    length++;\n\n    const buffer = new DataView(new ArrayBuffer(length + 4));\n\n    buffer.setUint16(0, lineNumber, false); // line number is stored as big endian\n    buffer.setUint16(2, length, true);\n\n    let offset = 4;\n\n    tokens.forEach(({ name, value }) => {\n      if (name === 'KEYWORD') {\n        buffer.setUint8(offset, value);\n        offset++;\n      } else if (name === 'NUMBER_DATA') {\n        const view = new Uint8Array(buffer.buffer);\n        view.set(value, offset);\n        offset += value.length;\n      } else {\n        const v = value.toString();\n        const view = new Uint8Array(buffer.buffer);\n        view.set(encode(v), offset);\n        offset += v.length;\n      }\n    });\n\n    // console.log(tokens);\n\n    return {\n      basic: new Uint8Array(buffer.buffer),\n      lineNumber,\n      tokens,\n      length,\n    };\n  }\n\n  // Get the next token from the current buffer. A token is an object with\n  // the following properties:\n  // - name: name of the pattern that this token matched (taken from rules).\n  // - value: actual string value of the token.\n  // - pos: offset in the current buffer where the token starts.\n  //\n  // If there are no more tokens in the buffer, returns null. In case of\n  // an error throws Error.\n  token() {\n    this._skipNonTokens();\n    if (this.pos >= this.bufLen) {\n      return null;\n    }\n\n    // The char at this.pos is part of a real token. Figure out which.\n    var c = this.buf.charAt(this.pos);\n    const _next = this.buf.charAt(this.pos + 1);\n\n    // comments are slurped elsewhere\n\n    // Look it up in the table of operators\n    var op = this.opTable[c];\n    if (op !== undefined) {\n      return { name: 'KEYWORD', value: op, pos: this.pos++ };\n    } else {\n      // Not an operator - so it's the beginning of another token.\n      // if alpha or starts with 0 (which can only be binary)\n      if (\n        Lexer._isAlpha(c) ||\n        c === '' ||\n        (c === '.' && Lexer._isAlpha(_next))\n      ) {\n        return this._processIdentifier();\n      } else if (Lexer._isLiteralNumeric(c)) {\n        this.inLiteral = true;\n        return { name: 'SYMBOL', value: c, pos: this.pos++ };\n      } else if (c === '.' && Lexer._isDigit(_next)) {\n        return this._processNumber();\n      } else if (Lexer._isDigit(c)) {\n        return this._processNumber();\n      } else if (Lexer._isLiteralReset(c)) {\n        this.inLiteral = false;\n        return { name: 'SYMBOL', value: c, pos: this.pos++ };\n      } else if (Lexer._isStatementSep(c)) {\n        this.inLiteral = false;\n        return { name: 'SYMBOL', value: c, pos: this.pos++ };\n      } else if (Lexer._isSymbol(c)) {\n        if (c === '<' || c === '>') {\n          // check if the next is a symbol\n          const value = this.opTable[\n            Object.keys(opTable).find(_ => _ === c + _next)\n          ];\n          if (value) {\n            return {\n              name: 'KEYWORD',\n              value,\n              pos: (this.pos += 2),\n            };\n          }\n        }\n        return { name: 'SYMBOL', value: c, pos: this.pos++ };\n      } else if (c === '\"') {\n        return this._processQuote();\n      } else if (Lexer._isNumericSymbol(c)) {\n        return { name: 'SYMBOL', value: c, pos: this.pos++ };\n      } else {\n        throw Error(`Token error at ${this.pos} (${c})\\n${this.buf}`);\n      }\n    }\n  }\n\n  static _isNumericSymbol(c) {\n    return c === '@' || c === '$';\n  }\n\n  static _isLiteralNumeric(c) {\n    return c === '%';\n  }\n\n  static _isBinary(c) {\n    return c === '1' || c === '0';\n  }\n\n  static _isNewLine(c) {\n    return c === '\\r' || c === '\\n';\n  }\n\n  static _isDigit(c) {\n    return c >= '0' && c <= '9';\n  }\n\n  static _isStatementSep(c) {\n    return c === ':';\n  }\n\n  static _isLiteralReset(c) {\n    return c === '=' || c === ',';\n  }\n\n  static _isSymbol(c) {\n    return '!,;-+/*^()<>#%$'.includes(c);\n  }\n\n  static _isAlpha(c) {\n    return (\n      (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z') || c === '_' || c === '$'\n    );\n  }\n\n  static _isAlphaNum(c) {\n    return (\n      (c >= 'a' && c <= 'z') ||\n      (c >= 'A' && c <= 'Z') ||\n      (c >= '0' && c <= '9') ||\n      c === '_'\n    );\n  }\n\n  _processLiteralNumber() {\n    var endPos = this.pos + 1;\n    let needsClose = false;\n    while (\n      (endPos < this.bufLen &&\n        (Lexer._isDigit(this.buf.charAt(endPos)) ||\n          this.buf.charAt(endPos) === '(' ||\n          this.buf.charAt(endPos) === '!')) ||\n      (needsClose && this.buf.charAt(endPos) === ')')\n    ) {\n      if (this.buf.charAt(endPos) === '(') {\n        needsClose = true; // only allow this once\n      }\n      endPos++;\n    }\n\n    const value = this.buf.substring(this.pos, endPos);\n\n    var tok = {\n      name: 'LITERAL_NUMBER',\n      value,\n      pos: this.pos,\n    };\n    this.pos = endPos;\n    return tok;\n  }\n\n  _processNumber() {\n    var endPos = this.pos + 1;\n    let exp = false;\n    while (\n      (endPos < this.bufLen &&\n        (Lexer._isDigit(this.buf.charAt(endPos)) ||\n          this.buf.charAt(endPos) === '.' ||\n          this.buf.charAt(endPos) === 'e')) ||\n      (exp && this.buf.charAt(endPos) === '-')\n    ) {\n      if (this.buf.charAt(endPos) === 'e') {\n        exp = true; // only allow this once\n      } else {\n        exp = false;\n      }\n      endPos++;\n    }\n\n    const value = this.buf.substring(this.pos, endPos);\n    let numeric = 0;\n\n    if (value.includes('.')) {\n      numeric = parseFloat(value);\n    } else {\n      numeric = parseInt(value, 10);\n    }\n\n    let name = 'NUMBER';\n    if (this.inLiteral) {\n      name = 'LITERAL_NUMBER';\n    }\n\n    var tok = {\n      name,\n      value,\n      numeric,\n      pos: this.pos,\n    };\n    this.pos = endPos;\n    return tok;\n  }\n\n  _processBinary(start = '') {\n    this._skipNonTokens();\n\n    if (start.length) {\n      this.pos += start.length;\n    }\n\n    var endPos = this.pos;\n\n    while (endPos < this.bufLen && Lexer._isBinary(this.buf.charAt(endPos))) {\n      endPos++;\n    }\n\n    var tok = {\n      name: 'BINARY',\n      value: start + this.buf.substring(this.pos, endPos).trim(),\n      pos: this.pos,\n    };\n    this.pos = endPos;\n    return tok;\n  }\n\n  _processComment() {\n    var endPos = this.pos;\n    // Skip until the end of the line\n    while (endPos < this.bufLen && !Lexer._isNewLine(this.buf.charAt(endPos))) {\n      endPos++;\n    }\n\n    var tok = {\n      name: 'COMMENT',\n      value: this.buf.substring(this.pos, endPos).trim(),\n      pos: this.pos,\n    };\n    this.pos = endPos + 1;\n    return tok;\n  }\n\n  _isOpCode(endPos) {\n    let curr = this.buf.substring(this.pos, endPos).toUpperCase();\n\n    const _next = this.buf.charAt(endPos, endPos + 1);\n\n    let ignorePeek = false;\n    if (_next == ' ' && curr === 'GO') {\n      // check if the next is \"SUB\" or \"TO\"\n      const next = this._peekToken(1).toUpperCase();\n      if (next === 'SUB' || next === 'TO') {\n        endPos = endPos + 1 + next.length;\n        curr = curr + ' ' + next;\n        ignorePeek = true;\n      }\n    }\n\n    if (this.opTable[curr] !== undefined) {\n      const peeked = this._peekToken(-1).toUpperCase();\n      if (ignorePeek === false && curr !== peeked) {\n        return false;\n      }\n      this.pos = endPos;\n\n      return {\n        name: 'KEYWORD',\n        value: this.opTable[curr],\n        pos: this.pos,\n      };\n    }\n    return false;\n  }\n\n  _peekToken(offset = 0) {\n    const tmp = this.pos;\n    this.pos += offset + 1;\n    this._skipNonTokens();\n    let endPos = this.pos + 1;\n    while (endPos < this.bufLen && Lexer._isAlphaNum(this.buf.charAt(endPos))) {\n      endPos++;\n    }\n\n    const value = this.buf.substring(this.pos, endPos);\n\n    this.pos = tmp;\n\n    return value;\n  }\n\n  _processIdentifier() {\n    var endPos = this.pos + 1;\n    while (endPos < this.bufLen && Lexer._isAlphaNum(this.buf.charAt(endPos))) {\n      let tok = this._isOpCode(endPos);\n\n      if (tok) {\n        return tok;\n      }\n      endPos++;\n    }\n\n    let tok = this._isOpCode(endPos);\n\n    if (tok) {\n      return tok;\n    }\n\n    // special case for GO<space>[TO|SUB]\n    let value = this.buf.substring(this.pos, endPos);\n\n    tok = {\n      name: 'IDENTIFIER',\n      value,\n      pos: this.pos,\n    };\n    this.pos = endPos;\n    return tok;\n  }\n\n  _processQuote() {\n    // this.pos points at the opening quote. Find the ending quote.\n    var end_index = this.buf.indexOf('\"', this.pos + 1);\n\n    if (end_index === -1) {\n      throw Error('Unterminated quote at ' + this.pos);\n    } else {\n      var tok = {\n        name: 'QUOTE',\n        value: this.buf.substring(this.pos, end_index + 1),\n        pos: this.pos,\n      };\n      this.pos = end_index + 1;\n      return tok;\n    }\n  }\n\n  _skipNonTokens() {\n    while (this.pos < this.bufLen) {\n      var c = this.buf.charAt(this.pos);\n      if (c == ' ' || c == '\\t' || c == '\\r' || c == '\\n') {\n        this.pos++;\n      } else {\n        break;\n      }\n    }\n  }\n}\n\n// const l = new Lexer();\n// const res = l.line(\n//   `\n// 5 let b=@01111100\n\n// `.trim()\n// ); // ?\n\n// bas2txtLines(res.basic); // ?\n","import { $ } from './$.js';\n\nexport class Tab {\n  constructor(parent, root) {\n    this.root = root;\n    this.id = root.id;\n  }\n\n  hide() {\n    this.root.style.display = 'none';\n  }\n\n  show() {\n    this.root.setAttribute('style', '');\n  }\n}\n\nexport default class Tabs {\n  constructor(selector) {\n    this.root = document.querySelector(selector);\n\n    const panels = $(selector + ' > section:not([hidden])');\n    this.panels = panels.map(el => new Tab(this, el));\n    const ids = panels.map(_ => _.id);\n\n    const tabNav = document.querySelector(selector + ' > .tabs ul');\n    panels.map(panel => {\n      const a = document.createElement('a');\n      a.href = '#' + panel.id;\n\n      a.innerText = panel.dataset.title;\n      const li = document.createElement('li');\n      li.appendChild(a);\n      tabNav.appendChild(li);\n    });\n\n    this.tabs = $(selector + ' > .tabs a');\n\n    this.tabs.on('click', e => {\n      e.preventDefault();\n      this.show(e.target.hash.substring(1));\n      window.history.pushState(null, '', e.target.hash);\n    });\n\n    this.show(window.location.hash.substring(1) || this.panels[0].id);\n\n    window.addEventListener('hashchange', () => {\n      const id = window.location.hash.substring(1);\n      if (!ids.includes(id)) return; // ignore this\n      this.show(id);\n    });\n  }\n\n  show(id) {\n    this.hide();\n    this.panels.find(_ => _.id === id).show();\n    this.tabs.find(_ => _.hash === '#' + id).className = 'selected';\n  }\n\n  hide() {\n    this.tabs.className = '';\n    this.panels.forEach(_ => _.hide());\n  }\n}\n","import drop from '../lib/dnd.js';\nimport { rgbFromIndex, transparent } from './lib/colour.js';\nimport save from '../lib/save.js';\nimport { decode, pngNoTransformFile } from './lib/parser.js';\nimport ImageWindow from './ImageWindow.js';\nimport { $ } from '../lib/$.js';\nimport SpriteSheet from './SpriteSheet.js';\nimport ColourPicker from './ColourPicker.js';\nimport Tool from './Tool.js';\nimport TileMap from './TileMap.js';\nimport { plus3DOSHeader } from '../bas/txt2bas.js';\nimport Tabs from '../lib/Tabs.js';\n\nconst container = document.querySelector('#container');\nconst ctx = container.getContext('2d');\nconst spritesContainer = document.querySelector('#sprites');\nconst debug = document.querySelector('#debug');\nconst picker = document.querySelector('.picker');\nconst upload = document.querySelector('#upload input');\nconst pickerColour = document.querySelector('.pickerColour div');\nconst buttons = $('#tools button[data-action]');\nconst tileDownloads = $('#tiles button');\n\nlet sprites = null;\n\nfunction newSpriteSheet(check = true) {\n  if (check) {\n    if (!confirm('Are you sure you want to create a blank new sprite sheet?')) {\n      return;\n    }\n  }\n\n  sprites = new SpriteSheet(\n    Uint8Array.from({ length: 256 * 16 * 4 }, (_, i) => {\n      if (check == false && i < 256) return i;\n      return transparent;\n    }),\n    ctx\n  );\n\n  // FIXME not quite right\n  tileMap.sprites = sprites;\n  tileMap.paint();\n\n  renderSpritePreviews();\n  renderCurrentSprite();\n}\n\nfunction download() {\n  const filename = prompt('Filename:', 'untitled.spr');\n  if (filename) {\n    save(sprites.data, filename);\n  }\n}\n\nnew Tabs('.tabbed');\nconst colour = new ColourPicker(8, pickerColour.parentNode);\nconst tool = new Tool({ colour });\nconst tileMap = new TileMap({ size: 16, sprites });\nlet imageWindow = null;\nwindow.tileMap = tileMap;\ndocument.querySelector('#tile-map-container').appendChild(tileMap.ctx.canvas);\n\nfunction fileToImageWindow(file) {\n  const res = pngNoTransformFile(file);\n  const ctx = document\n    .querySelector('#png-importer canvas.png')\n    .getContext('2d');\n  imageWindow = new ImageWindow(res.data, ctx, res.png.width, res.png.height);\n  imageWindow.oncopy = (data) => sprites.set(data);\n  window.imageWindow = imageWindow;\n  imageWindow.paint();\n}\n\ndrop(document.querySelector('#png-importer'), fileToImageWindow);\n\nconst importMask = document.querySelector('#png-container .focus');\n$('#png-import-tools input[type=range]').on('input', (e) => {\n  const v = parseInt(e.target.value);\n  importMask.style.borderColor = `rgba(127, 127, 127, ${v / 100})`;\n});\n\n$('#png-import-tools button').on('click', (e) => {\n  const action = e.target.dataset.action;\n  if (action === 'zoom-in') {\n    imageWindow.zoom++;\n  }\n\n  if (action === 'zoom-out') {\n    imageWindow.zoom--;\n  }\n\n  if (action === 'copy') {\n    imageWindow.copy();\n  }\n});\n\nbuttons.on('click', (e) => {\n  const action = e.target.dataset.action;\n\n  if (action === 'new') {\n    newSpriteSheet(true);\n  }\n\n  if (action === 'undo') {\n    sprites.undo();\n  }\n\n  let currentSprite = sprites.current;\n  const totalSprites = sprites.length;\n\n  if (action.startsWith('ro')) {\n    const left = action === 'rol';\n    const right = action === 'ror';\n    if (\n      (right && currentSprite == totalSprites - 1) ||\n      (left && currentSprite === 0)\n    ) {\n      return;\n    }\n\n    sprites.snapshot();\n    const offset = 256 * currentSprite;\n    const copy = sprites.data.slice(offset, offset + 256);\n    const next = (currentSprite + (left ? -1 : 1)) * 256;\n    sprites.data.set(sprites.data.slice(next, next + 256), offset);\n    sprites.data.set(copy, next);\n    sprites.current += left ? -1 : 1;\n    sprites.rebuild(sprites.current - 1);\n    sprites.rebuild(sprites.current + 1);\n    sprites.rebuild(sprites.current);\n    sprites.paint();\n  }\n\n  if (action === 'copy') {\n    sprites.copy();\n  }\n\n  if (action === 'paste') {\n    sprites.paste();\n  }\n\n  if (action === 'clear') {\n    sprites.clear();\n  }\n\n  if (action === 'download') {\n    download();\n  }\n});\n\npicker.addEventListener('mousedown', (e) => {\n  colour.value = e.target.dataset.value;\n});\n\nlet down = false;\ncontainer.addEventListener(\n  'mousedown',\n  (event) => {\n    down = true;\n    tool.start(event);\n  },\n  true\n);\n\ncontainer.addEventListener(\n  'mouseup',\n  () => {\n    down = false;\n    tool.end();\n  },\n  true\n);\n\ncontainer.addEventListener(\n  'mousemove',\n  (e) => {\n    if (down) {\n      container.onclick(e);\n    }\n  },\n  true\n);\n\ncontainer.onclick = (e) => {\n  if (e.altKey || e.ctrlKey) {\n    colour.value = sprites.pget(sprites.getCoords(e));\n  } else {\n    tool.apply(e, sprites);\n  }\n};\n\n// main key handlers\ndocument.body.addEventListener('keyup', (e) => {\n  if (e.key === 'Shift') {\n    tool.shift(false);\n  }\n});\n\ndocument.body.addEventListener('keydown', (e) => {\n  if (e.key === 'Shift') {\n    tool.shift(true);\n  }\n\n  if (e.shiftKey && e.key === 'ArrowLeft') {\n    imageWindow.shiftX(true, e.ctrlKey ? 8 : 1);\n  }\n  if (e.shiftKey && e.key === 'ArrowRight') {\n    imageWindow.shiftX(false, e.ctrlKey ? 8 : 1);\n  }\n  if (e.shiftKey && e.key === 'ArrowUp') {\n    imageWindow.shiftY(true, e.ctrlKey ? 8 : 1);\n  }\n  if (e.shiftKey && e.key === 'ArrowDown') {\n    imageWindow.shiftY(false, e.ctrlKey ? 8 : 1);\n  }\n\n  if (e.key >= '1' && e.key <= '8') {\n    colour.index = parseInt(e.key, 10) - 1;\n    return;\n  }\n\n  if (e.shiftKey === false && e.key === 'z' && (e.metaKey || e.ctrlKey)) {\n    sprites.undo();\n    return;\n  }\n\n  if (e.key === 'D') {\n    download();\n    return;\n  }\n\n  if (!e.shiftKey) {\n    let current = sprites.current;\n    if (e.key === 'ArrowLeft') {\n      current--;\n    }\n    if (e.key === 'ArrowRight') {\n      current++;\n    }\n\n    if (current === sprites.length) {\n      current = 0;\n    } else if (current < 0) {\n      current = sprites.length - 1;\n    }\n\n    if (current !== sprites.current) {\n      sprites.current = current;\n    }\n  }\n});\n\nfunction buildStyleSheet() {\n  let css = '';\n  for (let i = 0; i < 256; i++) {\n    const { r, g, b, a } = rgbFromIndex(i);\n    css += `.c-${i} { background: rgba(${[r, g, b, a].join(', ')}); }`;\n  }\n  const s = document.createElement('style');\n  s.innerText = css;\n  document.head.append(s);\n}\n\nfunction renderCurrentSprite() {\n  try {\n    spritesContainer.querySelector('.focus').classList.remove('focus');\n  } catch (e) {\n    // noop\n  }\n\n  const focused = document.querySelector(\n    `#sprites > :nth-child(${sprites.current + 1})`\n  );\n  if (focused) focused.classList.add('focus');\n  sprites.paint();\n}\n\nfunction renderSpritePreviews() {\n  spritesContainer.innerHTML = '';\n  sprites.getPreviewElements().map((_) => spritesContainer.appendChild(_));\n}\n\nfunction fileHandler(file) {\n  file = decode(file);\n  sprites = new SpriteSheet(file, ctx);\n  tileMap.sprites = sprites;\n  tileMap.paint();\n\n  renderSpritePreviews();\n  renderCurrentSprite();\n}\n\nfunction render(data, into) {\n  into.innerHTML = '';\n  for (let i = 0; i < data.length; i++) {\n    let index = data[i];\n    into.appendChild(makePixel(index, i));\n  }\n}\n\nfunction makePixel(index, dataIndex) {\n  const d = document.createElement('div');\n  d.className = 'c-' + index;\n  d.dataset.value = index;\n  d.dataset.index = dataIndex;\n  d.title = `${index} -- 0x${index.toString(16).padStart(2, '0')}`;\n  return d;\n}\n\ncontainer.onmousemove = (e) => {\n  let { x, y } = sprites.getCoords(e);\n  const value = sprites.pget({ x, y });\n\n  debug.innerHTML = `X:${x} Y:${y} -- ${value} 0x${value\n    .toString(16)\n    .padStart(2, '0')}`;\n};\n\ncontainer.onmouseout = () => {\n  debug.innerHTML = '&nbsp;';\n};\n\nspritesContainer.addEventListener('click', (e) => {\n  const node = e.target;\n  if (node.nodeName === 'CANVAS') {\n    sprites.current = Array.from(node.parentNode.childNodes).indexOf(node);\n  }\n});\n\ndrop(document.documentElement, fileHandler);\n\ndocument.documentElement.ondrop = async (e) => {\n  e.preventDefault();\n  const files = e.dataTransfer.files;\n\n  console.log('file length', files.length);\n\n  if (files.length === 1) {\n    const droppedFile = files[0];\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      fileHandler(new Uint8Array(event.target.result));\n    };\n    reader.readAsArrayBuffer(droppedFile);\n  } else {\n    let id = sprites.current + 1;\n    await Promise.all(\n      Array.from(files).map((file) => {\n        const reader = new FileReader();\n        return new Promise((resolve) => {\n          reader.onload = (event) => {\n            const res = decode(new Uint8Array(event.target.result));\n            sprites.current = id;\n            sprites.set(res);\n            id++;\n            resolve();\n          }; // data url!\n          reader.readAsArrayBuffer(file);\n        });\n      })\n    );\n    renderSpritePreviews();\n    renderCurrentSprite();\n  }\n};\n\nupload.addEventListener('change', (e) => {\n  const droppedFile = e.target.files[0];\n  const reader = new FileReader();\n  reader.onload = (event) => {\n    fileHandler(new Uint8Array(event.target.result));\n  };\n  reader.readAsArrayBuffer(droppedFile);\n});\n\n$('input[name=\"transparency\"]').on('change', (e) => {\n  document.documentElement.dataset.transparency = e.target.value;\n});\n\ntileDownloads.on('click', (e) => {\n  console.log(e.target.dataset.type);\n  const filename = prompt('Filename:', 'untitled.map');\n  if (filename) {\n    const data = new Uint8Array(tileMap.bank.length + 128);\n    data.set(plus3DOSHeader(data, { hType: 3, hOffset: 0x8000 }));\n    data.set(tileMap.bank, 128);\n    save(data, filename);\n  }\n});\n\n// support native paste of pngs\ndocument.onpaste = async (event) => {\n  const items = (event.clipboardData || event.originalEvent.clipboardData)\n    .items;\n  const files = [];\n  for (let index in items) {\n    const item = items[index];\n    if (item.kind === 'file' && item.type === 'image/png') {\n      files.push(item);\n    }\n  } // will only ever be 1 file :(\n\n  let id = sprites.current;\n\n  await Promise.all(\n    files.map((item) => {\n      const blob = item.getAsFile();\n      const reader = new FileReader();\n      return new Promise((resolve) => {\n        reader.onload = (event) => {\n          const res = decode(new Uint8Array(event.target.result));\n          sprites.current = id;\n          sprites.set(res);\n          id++;\n          resolve();\n        }; // data url!\n        reader.readAsArrayBuffer(blob);\n      });\n    })\n  );\n\n  renderSpritePreviews();\n  renderCurrentSprite();\n};\n\nnewSpriteSheet(false);\n\n// render the colour picker\nrender(\n  Uint8Array.from({ length: 256 }, (_, i) => i),\n  picker\n);\nbuildStyleSheet();\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}