{"version":3,"sources":["lib/dnd.js","scr-tools/lib/zx-colour.js","scr-tools/lib/Zoom.js","scr-tools/lib/scr.js","lib/$.js","lib/save.js","scr-tools/lib/matrices.js","scr-tools/lib/Dither.js","scr-tools/lib/image.js","scr-tools/lib/retrofy.js","scr-tools/index.js","../node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["drop","root","callback","ondragover","ondragend","addEventListener","e","preventDefault","stopPropagation","console","log","droppedFile","dataTransfer","files","reader","FileReader","onload","event","Uint8Array","target","result","readAsArrayBuffer","brightColoursLookup","Map","set","toString","normalColoursLookup","brightColours","normalColours","getIndexForXY","width","x","y","order","Zoom","constructor","buffer","document","body","id","HTMLImageElement","img","canvas","createElement","appendChild","height","ctx","getContext","drawImage","parentNode","replaceChild","CanvasRenderingContext2D","sourceCtx","getImageData","data","toBlob","blob","url","URL","createObjectURL","style","background","clearRect","ImageData","isVisible","_last","makeVisible","className","scale","w","h","imageRendering","setProperty","put","imageData","putImageData","seeXY","key","pixel","strokeStyle","strokeRect","sourceWidth","source","Uint8ClampedArray","print","i","j","index","end","offset","subarray","slice","toBlink","blinkOn","block","attribute","start","pixels","ink","paper","readAttributes","ptr","byte","colour","load","fetch","arrayBuffer","sleep","ms","Promise","resolve","setTimeout","draw","third","ctr","line","bit","stream","attribs","type","blink","push","pixelsForSCR","loadBlinkAttributes","join","timer","setInterval","doBlink","stop","clearInterval","length","forEach","item","main","zoom","window","fillStyle","fillRect","onmousemove","bright","readFromPoint","pageX","pageY","innerHTML","padStart","onclick","values","pixelsToBytes","canvasImageData","row","putPixels","allPixels","allData","getInkFromPixel","rgb","shiftBright","get","attributesForBlock","inks","fill","Object","keys","count","Array","from","map","filter","sort","a","b","putAttributes","inkData","download","filename","click","node","MouseEvent","dispatchEvent","Blob","href","revokeObjectURL","ArrayNode","Proxy","obj","prop","value","el","res","on","handler","options","emit","Event","$","s","querySelectorAll","warn","fileName","isArray","oneDimensional","factor","floydSteinberg","jarvisJudiceNinke","stucki","atkinson","burkes","sierra3","sierra2","sierraLite","none","colorMap","getDistance","current","match","redDifference","greenDifference","blueDifference","defaultFindColor","shortestDistance","Number","MAX_SAFE_INTEGER","distance","defaults","step","channels","diffusionFactor","clip","findColor","matrix","matrices","Dither","dither","settings","k","ref","d","handlePixel","calculateIndex","currentColor","l","newColor","q","ref1","diffuseError","applyNewColor","channelOffset","entry","len","results","di","dx","dy","results1","m","ref2","results2","image","imageToBlob","then","fileToBinary","contrast","intercept","threshold","_","r","g","test","v","invertPotentialInk","inkCount","c","crop","destination","longest","shortest","imageToCanvas","imageToPixels","file","onloadend","all","debug","Image","crossOrigin","src","reject","onerror","bufferCtx","render","pixelData","renderFromInk","originalData","pixelsToImage","toDataURL","prompt","scrBlob","scrURL","container","scrCtx","ul","li","attribsLI","img2","inkImg","pixelImg","zoomOriginal","zoomPixel","zoomInk","zoomResult","rootCanvas","querySelector","classList","add","hover","bind","putInkForBlock","newBlock","attributes","blockBuffer","location","search","includes","basename","split","altDownload","isSCR","toUpperCase","endsWith","div","button","innerText","prepend","fileHandler","name","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","protocol","ws","onmessage","JSON","parse","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","clear","hmrApply","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","getElementById","remove","stackTrace","getParents","modules","parents","dep","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"scr-tools.628f49dc.js","sourceRoot":"../public","sourcesContent":["export default function drop(root, callback) {\n  root.ondragover = () => false;\n  root.ondragend = () => false;\n  root.addEventListener(\n    'drop',\n    e => {\n      e.preventDefault();\n      e.stopPropagation();\n      console.log('on ', root);\n\n      const droppedFile = e.dataTransfer.files[0];\n      const reader = new FileReader();\n      reader.onload = event => {\n        callback(new Uint8Array(event.target.result));\n      };\n      reader.readAsArrayBuffer(droppedFile);\n    },\n    false\n  );\n}\n","export const brightColoursLookup = new Map();\nbrightColoursLookup.set([0, 0, 0].toString(), 0b000);\nbrightColoursLookup.set([0, 0, 0xff].toString(), 0b001);\nbrightColoursLookup.set([0xff, 0, 0].toString(), 0b010);\nbrightColoursLookup.set([0xff, 0, 0xff].toString(), 0b011);\nbrightColoursLookup.set([0, 0xff, 0].toString(), 0b100);\nbrightColoursLookup.set([0, 0xff, 0xff].toString(), 0b101);\nbrightColoursLookup.set([0xff, 0xff, 0].toString(), 0b110);\nbrightColoursLookup.set([0xff, 0xff, 0xff].toString(), 0b111);\n\nexport const normalColoursLookup = new Map();\nnormalColoursLookup.set([0, 0, 0].toString(), 0b000);\nnormalColoursLookup.set([0, 0, 0xd7].toString(), 0b001);\nnormalColoursLookup.set([0xd7, 0, 0].toString(), 0b010);\nnormalColoursLookup.set([0xd7, 0, 0xd7].toString(), 0b011);\nnormalColoursLookup.set([0, 0xd7, 0].toString(), 0b100);\nnormalColoursLookup.set([0, 0xd7, 0xd7].toString(), 0b101);\nnormalColoursLookup.set([0xd7, 0xd7, 0].toString(), 0b110);\nnormalColoursLookup.set([0xd7, 0xd7, 0xd7].toString(), 0b111);\n\nexport const brightColours = {\n  0b000: [0, 0, 0],\n  0b001: [0, 0, 0xff],\n  0b010: [0xff, 0, 0],\n  0b011: [0xff, 0, 0xff],\n  0b100: [0, 0xff, 0],\n  0b101: [0, 0xff, 0xff],\n  0b110: [0xff, 0xff, 0],\n  0b111: [0xff, 0xff, 0xff],\n};\n\nexport const normalColours = {\n  0b000: [0, 0, 0],\n  0b001: [0, 0, 0xd7],\n  0b010: [0xd7, 0, 0],\n  0b011: [0xd7, 0, 0xd7],\n  0b100: [0, 0xd7, 0],\n  0b101: [0, 0xd7, 0xd7],\n  0b110: [0xd7, 0xd7, 0],\n  0b111: [0xd7, 0xd7, 0xd7],\n};\n","function getIndexForXY(width, x, y) {\n  return width * y + x;\n}\n\nlet order = 1;\n\nexport default class Zoom {\n  constructor(buffer, target = document.body, id) {\n    this.target = target;\n    this.order = order++;\n    this.id = id || `zoom-${this.order}`;\n    if (buffer instanceof HTMLImageElement) {\n      const img = buffer;\n      const canvas = document.createElement('canvas');\n      target.appendChild(canvas);\n      canvas.width = img.width;\n      canvas.height = img.height;\n      const ctx = (buffer = canvas.getContext('2d'));\n      ctx.drawImage(img, 0, 0);\n      img.parentNode.replaceChild(canvas, img);\n    }\n\n    if (buffer instanceof CanvasRenderingContext2D) {\n      const ctx = (this.sourceCtx = buffer);\n      this.buffer = buffer.getImageData(\n        0,\n        0,\n        buffer.canvas.width,\n        buffer.canvas.height\n      ).data;\n      ctx.canvas.toBlob(blob => {\n        const url = URL.createObjectURL(blob);\n        ctx.canvas.style.background = `url(${url}) no-repeat`;\n        ctx.clearRect(0, 0, buffer.canvas.width, buffer.canvas.height);\n      });\n    } else {\n      this.buffer = buffer instanceof ImageData ? buffer.data : buffer;\n    }\n    this.isVisible = false;\n    this._last = null;\n  }\n\n  makeVisible(target = this.target) {\n    const canvas = document.createElement('canvas');\n    canvas.className = 'zoom';\n    canvas.id = this.id;\n    target.appendChild(canvas);\n    this.ctx = canvas.getContext('2d');\n\n    const scale = 20;\n    const w = (canvas.width = 8);\n    const h = (canvas.height = 8);\n    canvas.style.imageRendering = 'pixelated';\n    canvas.style.width = `${w * scale}px`;\n    canvas.style.height = `${h * scale}px`;\n    canvas.style.setProperty('--order', this.order);\n    this.isVisible = true;\n\n    return this;\n  }\n\n  put(imageData) {\n    const ctx = this.ctx;\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  seeXY(x, y) {\n    const key = `${x}x${y}`;\n    if (key === this._last) return;\n    this._last = key;\n    if (!this.isVisible) this.makeVisible();\n    const imageData = new ImageData(this.pixel(x, y), 8, 8);\n    this.ctx.putImageData(imageData, 0, 0);\n\n    if (this.sourceCtx) {\n      const ctx = this.sourceCtx;\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n      ctx.strokeStyle = 'white';\n      ctx.strokeRect(x * 8 + 0.5, y * 8 + 0.5, 8, 8);\n      ctx.strokeStyle = 'black';\n      ctx.strokeRect(x * 8 - 0.5, y * 8 - 0.5, 8, 8);\n    }\n  }\n\n  pixel(x = 0, y = 0) {\n    const sourceWidth = 256;\n    const width = 8;\n    const height = 8;\n    const source = this.buffer;\n\n    const data = new Uint8ClampedArray(width * height * 4);\n\n    const print = false; //x === 31 && y === 23;\n\n    for (let i = 0; i < height; i++) {\n      const j = getIndexForXY(sourceWidth, x * 8, y * 8 + i);\n      const index = j * 4;\n      const end = index + width * 4;\n      const offset = i * width * 4;\n      if (print) {\n        console.log(\n          'j: %s, index: %s, end: %s',\n          j,\n          index,\n          end,\n          x * 8,\n          i,\n          source.subarray(index, end)\n        );\n      }\n      data.set(source.slice(index, end), offset);\n    }\n\n    return data;\n  }\n}\n","import {\n  brightColours,\n  normalColours,\n  normalColoursLookup,\n  brightColoursLookup,\n} from './zx-colour.js';\n\nimport Zoom from './Zoom.js';\n\nlet toBlink = [];\nlet blinkOn = false;\n\nfunction block(\n  x = 0,\n  y = 0,\n  buffer, // expected to be 6912 long (2048 * 3 + 768)\n  attribute = buffer.subarray(2048 * 3)[y * 32 + x]\n) {\n  const start = ((y / 8) | 0) * 2048;\n  const pixels = buffer.subarray(start, start + 2048);\n\n  // reminder: paper is binary 0, ink is 1\n  const { ink, paper } = readAttributes(attribute);\n  const pixel = new Uint8ClampedArray(4 * 8 * 8);\n  y = y % 8;\n\n  for (let i = 0; i < 8; i++) {\n    const ptr = x + 256 * i + y * 32;\n    const byte = pixels[ptr];\n\n    // imageData rgba 8x1\n    for (let j = 0; j < 8; j++) {\n      // determines bit for i, based on MSb as left most pixel\n      const colour = (byte & (1 << (7 - j))) === 0 ? paper : ink;\n\n      const offset = j * 4 + 4 * 8 * i;\n      pixel[offset + 0] = colour[0];\n      pixel[offset + 1] = colour[1];\n      pixel[offset + 2] = colour[2];\n      pixel[offset + 3] = 255;\n    }\n  }\n\n  return pixel;\n}\n\nexport async function load(url) {\n  return new Uint8Array(await (await fetch(url)).arrayBuffer());\n}\n\nasync function sleep(ms) {\n  // return;\n  if (!ms) return;\n  return new Promise(resolve => setTimeout(() => resolve(), ms));\n}\n\nasync function put(ctx, imageData, x, y) {\n  ctx.putImageData(imageData, x, y);\n  await sleep(0);\n}\n\nasync function draw(ctx, third, data) {\n  const imageData = new Uint8ClampedArray(4 * 8);\n  let ctr = 0;\n  for (let offset = 0; offset < 8; offset++) {\n    for (let line = 0; line < 8; line++) {\n      for (let i = 0; i < 32; i++) {\n        let j = 0;\n        const ptr = ctr++;\n        const byte = data[ptr];\n\n        // imageData rgba 8x1\n        for (; j < 8; j++) {\n          // determines bit for i, based on MSb\n          const bit = (byte & (1 << (7 - j))) === 0 ? 0 : 255;\n\n          const offset = j * 4;\n          imageData[offset + 0] = bit;\n          imageData[offset + 1] = bit;\n          imageData[offset + 2] = bit;\n          imageData[offset + 3] = 255; // - bit; // alpha\n        }\n        const x = i * 8;\n        const y = (ctx.canvas.height / 3) * third + line * 8 + offset;\n        await put(ctx, new ImageData(imageData, 8, 1), x, y);\n      }\n    }\n  }\n}\n\n// stream individual whole bytes into the canvas\nexport async function stream(ctx, byte, index) {\n  const third = index >> 11; // 0..2047, 2048..4095, 4096..6143\n\n  if (third === 3) {\n    // colour\n    const attribs = readAttributes(byte);\n    const x = (index % 32) * 8;\n    const y = ((index >> 5) % 64) * 8;\n\n    const block = ctx.getImageData(x, y, 8, 8);\n    for (let i = 0; i < 8 * 8; i++) {\n      const type = block.data[i * 4] === 255 ? 'ink' : 'paper';\n      block.data.set(attribs[type], i * 4);\n    }\n\n    if (attribs.blink && attribs.ink !== attribs.paper) {\n      toBlink.push({\n        attribute: byte,\n        x: x / 8,\n        y: y / 8,\n      });\n    }\n\n    await put(ctx, block, x, y);\n\n    return;\n  }\n\n  const imageData = new Uint8ClampedArray(4 * 8); // 1x8 pixel array\n\n  for (let j = 7; j >= 0; j--) {\n    // determines bit for i, based on MSb\n    const bit = (byte & (1 << j)) === 0 ? 0 : 255;\n    imageData.set([bit, bit, bit, 255], (7 - j) * 4); // place the bits forward\n  }\n\n  // build the line based on the 8bit byte\n  // for (let j = 0; j < 8; j++) {\n  //   // determines bit for i, based on MSb\n  //   const bit = (byte & (1 << (7 - j))) === 0 ? 0 : 255;\n  //   imageData.set([bit, bit, bit, 255], j * 4);\n  // }\n\n  const x = index % 32;\n  const y = (((index >> 5) * 8) % 64) + third * 56; // this is the y coord\n  const offset = index >> 8;\n\n  // await\n  put(ctx, new ImageData(imageData, 8, 1), x * 8, y + offset);\n}\n\nexport function pixelsForSCR(buffer, ctx) {\n  const w = 256;\n  const h = 192;\n  const pixels = new Uint8ClampedArray(w * h * 4); // 196,608\n  for (let y = 0; y < h / 8; y++) {\n    for (let x = 0; x < w / 8; x++) {\n      const pixel = block(x, y, buffer); // returns 8x8\n      ctx.putImageData(new ImageData(pixel, 8, 8), x * 8, y * 8);\n    }\n  }\n\n  return pixels;\n}\n\nexport function loadBlinkAttributes(buffer, ctx) {\n  toBlink = [];\n\n  // 768\n  for (let i = 6144; i <= 6912; i++) {\n    const attribute = buffer[i];\n    const { ink, paper, blink } = readAttributes(attribute);\n    if (blink && ink.join('') !== paper.join('')) {\n      const x = i % 32;\n      const y = (i >> 5) % 64;\n\n      toBlink.push({\n        attribute,\n        i,\n        x,\n        y,\n      });\n    }\n  }\n\n  let timer = null;\n\n  const blink = {\n    start: () => {\n      timer = setInterval(() => doBlink(ctx, buffer), 333);\n    },\n    stop: () => {\n      return clearInterval(timer);\n    },\n  };\n\n  return blink;\n}\n\nasync function colour(ctx, buffer) {\n  const attribs = buffer.subarray(2048 * 3);\n\n  for (let i = 0; i < attribs.length; i++) {\n    const attribute = attribs[i];\n    const { ink, paper, blink } = readAttributes(attribute);\n\n    const x = i % (ctx.canvas.width / 8);\n    const y = (i / (ctx.canvas.width / 8)) | 0;\n\n    const pixel = new ImageData(block(x, y, buffer), 8, 8);\n\n    if (blink && ink.join('') !== paper.join('')) {\n      toBlink.push({\n        attribute,\n        x,\n        y,\n      });\n    }\n\n    await put(ctx, pixel, x * 8, y * 8); // replace the whole shebang\n  }\n}\n\nfunction doBlink(ctx, buffer) {\n  blinkOn = !blinkOn;\n\n  toBlink.forEach(item => {\n    const { x, y } = item;\n    let attribute = item.attribute;\n    if (blinkOn) {\n      // swap the paper and ink\n      attribute =\n        (attribute & 192) + // bright + blink\n        ((attribute & 7) << 3) + // ink moved to paper\n        ((attribute & 56) >> 3); // paper moved to ink\n    }\n    const pixel = new ImageData(block(x, y, buffer, attribute), 8, 8);\n    put(ctx, pixel, x * 8, y * 8);\n  });\n}\n\nexport default async function main(url) {\n  const buffer = await load(url || './screens/remy.scr');\n\n  const canvas = document.createElement('canvas');\n  const log = document.createElement('pre');\n\n  document.body.appendChild(canvas);\n  const zoom = new Zoom(buffer);\n  document.body.appendChild(log);\n  const ctx = canvas.getContext('2d');\n\n  window.ctx = ctx;\n\n  const scale = 2;\n  const w = (canvas.width = 256);\n  const h = (canvas.height = 192);\n  canvas.style.imageRendering = 'pixelated';\n  canvas.style.width = `${w * scale}px`;\n  canvas.style.height = `${h * scale}px`;\n  ctx.fillStyle = '#ccc';\n  ctx.fillRect(0, 0, w, h);\n\n  await draw(ctx, 0, buffer.subarray(0, 2048));\n  await draw(ctx, 1, buffer.subarray(2048, 2048 * 2));\n  await draw(ctx, 2, buffer.subarray(2048 * 2, 2048 * 3));\n\n  const attribs = buffer.subarray(2048 * 3);\n\n  await colour(ctx, buffer);\n  zoom.seeXY(0, 0);\n\n  // setInterval(() => zoom.seeXY(), 1000);\n\n  canvas.onmousemove = e => {\n    const { ptr, x, y, byte, bright, blink, ink, paper } = readFromPoint({\n      attribs,\n      scale,\n      x: e.pageX,\n      y: e.pageY,\n    });\n\n    zoom.seeXY(x / 8, y / 8);\n\n    log.innerHTML = `ptr: ${ptr}\nx: ${x} (${x / 8})\ny: ${y} (${y / 8})\nbyte: ${byte}\nink: <span style=\"color: white; text-shadow: 1px 1px 0 #000; background: rgb(${ink.join(\n      ','\n    )})\">${(byte & 7).toString(2).padStart(3, '0')}</span>\npaper: <span style=\"color: white; text-shadow: 1px 1px 0 #000; background: rgb(${paper.join(\n      ','\n    )})\">${((byte & 56) >> 3).toString(2).padStart(3, '0')}</span>\nbright: ${bright}\nblink: ${blink}\n`;\n  };\n\n  canvas.onclick = e => {\n    const { x, y, ink, paper } = readFromPoint({\n      attribs,\n      scale,\n      x: e.pageX,\n      y: e.pageY,\n    });\n\n    toBlink.push({\n      x,\n      y,\n      ink,\n      paper,\n    });\n  };\n\n  setInterval(() => doBlink(ctx, buffer), 333);\n}\n\nexport function blink(ctx, buffer) {\n  return setInterval(() => doBlink(ctx, buffer), 333);\n}\n\nexport function readAttributes(byte) {\n  const bright = !!(byte & 64);\n  const source = bright ? brightColours : normalColours;\n\n  const values = {\n    ink: byte & 7,\n    paper: (byte & 56) >> 3,\n  };\n\n  const ink = source[values.ink]; // 0b00000111\n  const paper = source[values.paper]; // 0b00111000\n  const blink = !!(byte & 128);\n\n  return {\n    values,\n    bright,\n    ink,\n    paper,\n    blink,\n  };\n}\n\nfunction readFromPoint({ x, y, scale = 1, attribs = [] }) {\n  x = (((x / scale) | 0) / 8) | 0;\n  y = (((y / scale) | 0) / 8) | 0;\n  const ptr = y * 32 + x;\n  const byte = attribs[ptr];\n\n  const { ink, paper, bright, blink } = readAttributes(byte);\n\n  return {\n    ptr,\n    x: x * 8,\n    y: y * 8,\n    byte,\n    ink,\n    paper,\n    blink,\n    bright,\n  };\n}\n\nfunction getIndexForXY(width, x, y) {\n  return width * y + x;\n}\n\n/**\n * Converts canvas image data to SCR binary format\n * @param {Number} third 0-2: the thirds of the screen data\n * @param {Uint8Array} arrayBuffer expected to be 3 * 2048 + 768 (empty)\n * @param {Uint8ClampedArray} canvasImageData canvas pixel data (expects to be filled)\n */\nexport function pixelsToBytes(third, arrayBuffer, canvasImageData) {\n  const data = arrayBuffer.subarray(third * 2048, (third + 1) * 2048);\n  const pixels = canvasImageData.subarray(\n    third * (canvasImageData.length / 3),\n    (third + 1) * (canvasImageData.length / 3)\n  );\n\n  let ptr = 0;\n\n  for (let offset = 0; offset < 8; offset++) {\n    for (let y = 0; y < 8; y++) {\n      const row = y * 8 + offset;\n\n      for (let x = 0; x < 32; x++) {\n        let byte = 0;\n\n        for (let j = 0; j < 8; j++) {\n          const index = getIndexForXY(256, x * 8 + j, row) * 4;\n          byte += (pixels[index] === 0 ? 1 : 0) << (7 - j);\n        }\n\n        data[ptr] = byte;\n        ptr++;\n      }\n    }\n  }\n}\n\n/**\n * Converts canvas image data to SCR binary format\n * @param {Number} third 0-2: the thirds of the screen data\n * @param {Uint8Array} allPixels expected to be 3 * 2048 + 768\n * @param {Uint8ClampedArray} allData canvas pixel data\n */\nexport function putPixels(third, allPixels, allData) {\n  const pixels = allPixels.subarray(third * 2048, (third + 1) * 2048);\n  const data = allData.subarray(\n    third * (allData.length / 3),\n    (third + 1) * (allData.length / 3)\n  );\n\n  let ptr = 0;\n\n  for (let offset = 0; offset < 8; offset++) {\n    for (let y = 0; y < 8; y++) {\n      const row = y * 8 + offset;\n\n      for (let x = 0; x < 32; x++) {\n        let bit = 0;\n\n        for (let j = 0; j < 8; j++) {\n          const index = getIndexForXY(256, x * 8 + j, row) * 4;\n          bit += (data[index] === 0 ? 1 : 0) << (7 - j);\n        }\n\n        pixels[ptr] = bit;\n        ptr++;\n      }\n    }\n  }\n}\n\nexport function getInkFromPixel(rgb, shiftBright = false) {\n  rgb = `${rgb[0]},${rgb[1]},${rgb[2]}`;\n  let ink = brightColoursLookup.get(rgb);\n\n  if (!ink) {\n    ink = normalColoursLookup.get(rgb);\n    if (shiftBright) ink <<= 3;\n  }\n\n  return ink;\n}\n\nexport function attributesForBlock(block, print) {\n  let attribute = 0;\n  const inks = new Uint8Array((0b111 << 3) + 1).fill(0); // container array\n\n  for (let i = 0; i < block.length / 4; i++) {\n    const ink = getInkFromPixel([...block.slice(i * 4, i * 4 + 3)], true);\n    inks[ink]++;\n  }\n\n  if (print) {\n    Object.keys(inks).forEach(\n      (ink, count) =>\n        inks[count] && console.log('ink %s (%s)', ink, inks[count])\n    );\n  }\n\n  let [{ ink: paper }, { ink } = { ink: 0 }] = Array.from(inks)\n    .map((count, ink) => ({ ink, count }))\n    .filter(({ count }) => count)\n    .sort((a, b) => a.count - b.count)\n    .slice(-2);\n\n  if (paper === null) {\n    paper = ink;\n  }\n\n  // this helps massage the colours into a better position\n  if (ink === 7 && paper !== 7) {\n    [ink, paper] = [paper, ink];\n  }\n\n  // work out the brightness based on the majority ink\n  if (ink >> 3 === 0 || paper >> 3 === 0) {\n    // if ink or paper is black, then take the brightness from the other colour\n    if (ink === 0 || paper === 0) {\n      const colour = ink === 0 ? paper : ink;\n      if (colour >>> 3 === 0) {\n        // colour is bright\n        attribute += 64;\n      } else {\n        // not bright\n      }\n    } else {\n      // we're dealing with bright\n      if (print) console.log('dealing with bright');\n      if (ink >> 3 === 0 && inks[ink] > inks[paper]) {\n        if (print) console.log('ink > paper', ink, paper);\n        attribute += 64;\n      } else if (paper >> 3 === 0 && inks[paper] > inks[ink]) {\n        if (print) console.log('paper > ink');\n        attribute += 64;\n      }\n    }\n  }\n\n  if (ink >> 3 !== 0) {\n    ink = ink >> 3;\n  }\n\n  if (paper >> 3 !== 0) {\n    paper = paper >> 3;\n  }\n\n  attribute += paper << 3;\n  attribute += ink;\n\n  return attribute;\n}\n\nexport function putAttributes(pixels, inkData) {\n  let ptr = 0;\n  const zoom = new Zoom(inkData);\n  for (let y = 0; y < 192 / 8; y++) {\n    for (let x = 0; x < 256 / 8; x++) {\n      const block = zoom.pixel(x, y);\n      const print = false; // x === 28 && y === 19;\n\n      pixels[2048 * 3 + ptr] = attributesForBlock(block, print);\n\n      ptr++;\n    }\n  }\n}\n\nexport function download(data, filename = 'image.png', type = 'image/png') {\n  const click = function(node) {\n    var event = new MouseEvent('click');\n    node.dispatchEvent(event);\n  };\n\n  const a = document.createElement('a');\n  a.download = filename;\n  const blob = new Blob([data], { type });\n  const url = URL.createObjectURL(blob);\n  a.href = url;\n  click(a);\n  URL.revokeObjectURL(url);\n}\n","class ArrayNode extends Array {\n  constructor() {\n    super();\n\n    // allow setting any node property via proxy\n    return new Proxy(this, {\n      set(obj, prop, value) {\n        const type = obj[0];\n\n        if (type && prop in type) {\n          return obj.filter(el => (el[prop] = value));\n        }\n\n        const res = (this[prop] = value);\n        return res;\n      },\n    });\n  }\n\n  on(event, handler, options) {\n    return this.filter(el => el.addEventListener(event, handler, options));\n  }\n\n  emit(type, data) {\n    const event = new Event(type, { data });\n    return this.filter(el => el.dispatchEvent(event));\n  }\n}\n\nexport const $ = (s, ctx = document) => {\n  const res = ctx.querySelectorAll(s);\n\n  if (res.length === 0) {\n    console.warn(`${s} zero results`);\n  }\n\n  return ArrayNode.from(res);\n};\n","export default (function() {\n  var a = document.createElement('a');\n  document.body.appendChild(a);\n  a.style = 'display: none';\n  return function(data, fileName) {\n    let blob = null;\n\n    if (data instanceof Blob) {\n      blob = data;\n    } else {\n      if (!Array.isArray(data)) {\n        data = [data];\n      }\n      blob = new Blob(data, { type: 'octet/stream' });\n    }\n    const url = URL.createObjectURL(blob);\n    a.href = url;\n    a.download = fileName;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n})();\n","export default {\n  oneDimensional: [\n    {\n      x: 1,\n      y: 0,\n      factor: 1,\n    },\n  ],\n  floydSteinberg: [\n    {\n      x: 1,\n      y: 0,\n      factor: 7 / 16,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 3 / 16,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 5 / 16,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 1 / 16,\n    },\n  ],\n  jarvisJudiceNinke: [\n    {\n      x: 1,\n      y: 0,\n      factor: 7 / 48,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 5 / 48,\n    },\n    {\n      x: -2,\n      y: 1,\n      factor: 3 / 48,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 5 / 48,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 7 / 48,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 5 / 48,\n    },\n    {\n      x: 2,\n      y: 1,\n      factor: 3 / 48,\n    },\n    {\n      x: -2,\n      y: 2,\n      factor: 1 / 48,\n    },\n    {\n      x: -1,\n      y: 2,\n      factor: 3 / 48,\n    },\n    {\n      x: 0,\n      y: 2,\n      factor: 5 / 48,\n    },\n    {\n      x: 1,\n      y: 2,\n      factor: 3 / 48,\n    },\n    {\n      x: 2,\n      y: 2,\n      factor: 1 / 48,\n    },\n  ],\n  stucki: [\n    {\n      x: 1,\n      y: 0,\n      factor: 8 / 42,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 4 / 42,\n    },\n    {\n      x: -2,\n      y: 1,\n      factor: 2 / 42,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 4 / 42,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 8 / 42,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 4 / 42,\n    },\n    {\n      x: 2,\n      y: 1,\n      factor: 2 / 42,\n    },\n    {\n      x: -2,\n      y: 2,\n      factor: 1 / 42,\n    },\n    {\n      x: -1,\n      y: 2,\n      factor: 2 / 42,\n    },\n    {\n      x: 0,\n      y: 2,\n      factor: 4 / 42,\n    },\n    {\n      x: 1,\n      y: 2,\n      factor: 2 / 42,\n    },\n    {\n      x: 2,\n      y: 2,\n      factor: 1 / 42,\n    },\n  ],\n  atkinson: [\n    {\n      x: 1,\n      y: 0,\n      factor: 1 / 8,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 1 / 8,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 1 / 8,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 1 / 8,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 1 / 8,\n    },\n    {\n      x: 0,\n      y: 2,\n      factor: 1 / 8,\n    },\n  ],\n  burkes: [\n    {\n      x: 1,\n      y: 0,\n      factor: 8 / 32,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 4 / 32,\n    },\n    {\n      x: -2,\n      y: 1,\n      factor: 2 / 32,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 4 / 32,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 8 / 32,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 4 / 32,\n    },\n    {\n      x: 2,\n      y: 1,\n      factor: 2 / 32,\n    },\n  ],\n  sierra3: [\n    {\n      x: 1,\n      y: 0,\n      factor: 5 / 32,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 3 / 32,\n    },\n    {\n      x: -2,\n      y: 1,\n      factor: 2 / 32,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 4 / 32,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 5 / 32,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 4 / 32,\n    },\n    {\n      x: 2,\n      y: 1,\n      factor: 2 / 32,\n    },\n    {\n      x: -1,\n      y: 2,\n      factor: 2 / 32,\n    },\n    {\n      x: 0,\n      y: 2,\n      factor: 3 / 32,\n    },\n    {\n      x: 1,\n      y: 2,\n      factor: 2 / 32,\n    },\n  ],\n  sierra2: [\n    {\n      x: 1,\n      y: 0,\n      factor: 4 / 16,\n    },\n    {\n      x: 2,\n      y: 0,\n      factor: 3 / 16,\n    },\n    {\n      x: -2,\n      y: 1,\n      factor: 1 / 16,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 2 / 16,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 3 / 16,\n    },\n    {\n      x: 1,\n      y: 1,\n      factor: 2 / 16,\n    },\n    {\n      x: 2,\n      y: 1,\n      factor: 1 / 16,\n    },\n  ],\n  sierraLite: [\n    {\n      x: 1,\n      y: 0,\n      factor: 2 / 4,\n    },\n    {\n      x: -1,\n      y: 1,\n      factor: 1 / 4,\n    },\n    {\n      x: 0,\n      y: 1,\n      factor: 1 / 4,\n    },\n  ],\n  none: [],\n};\n","import matrices from './matrices.js';\n\nconst colorMap = [\n  [0, 0, 0xff],\n  [0xff, 0, 0],\n  [0xff, 0, 0xff],\n  [0, 0xff, 0],\n  [0, 0xff, 0xff],\n  [0xff, 0xff, 0],\n  [0xff, 0xff, 0xff],\n  [0, 0, 0],\n  [0, 0, 0xd7],\n  [0xd7, 0, 0],\n  [0xd7, 0, 0xd7],\n  [0, 0xd7, 0],\n  [0, 0xd7, 0xd7],\n  [0xd7, 0xd7, 0],\n  [0xd7, 0xd7, 0xd7],\n];\n\nfunction getDistance(current, match) {\n  const redDifference = current[0] - match[0];\n  const greenDifference = current[1] - match[1];\n  const blueDifference = current[2] - match[2];\n\n  return (\n    redDifference * redDifference +\n    greenDifference * greenDifference +\n    blueDifference * blueDifference\n  );\n}\n\n// feels expensive, but https://www.cyotek.com/blog/finding-nearest-colors-using-euclidean-distance\nfunction defaultFindColor(rgb) {\n  let shortestDistance;\n  let index;\n\n  index = -1;\n  shortestDistance = Number.MAX_SAFE_INTEGER;\n\n  for (let i = 0; i < colorMap.length; i++) {\n    const match = colorMap[i];\n    const distance = getDistance(rgb, match);\n\n    if (distance < shortestDistance) {\n      index = i;\n      shortestDistance = distance;\n    }\n  }\n\n  return [...colorMap[index], 255];\n}\n\nconst defaults = {\n  step: 4,\n  channels: 4,\n  diffusionFactor: 0.9,\n  clip: () => {},\n  findColor: defaultFindColor,\n  matrix: matrices.floydSteinberg,\n};\n\nexport default class Dither {\n  constructor(options) {\n    this.options = { ...defaults, ...options };\n  }\n\n  static get defaultFindColor() {\n    return defaultFindColor;\n  }\n\n  static get matrices() {\n    return matrices;\n  }\n\n  dither(buffer, width, settings = {}) {\n    let i, k, ref, x, y;\n    const options = { ...this.options, ...settings };\n\n    const d = [];\n    for (\n      i = k = 0, ref = buffer.length;\n      0 <= ref ? k <= ref : k >= ref;\n      i = 0 <= ref ? ++k : --k\n    ) {\n      d.push(buffer[i]);\n    }\n    const height = buffer.length / (options.channels * width);\n    const result = [];\n    y = 0;\n    while (y < height) {\n      x = 0;\n      while (x < width) {\n        this.handlePixel(x, y, d, result, width, options);\n        x += options.step;\n      }\n      y += options.step;\n    }\n    return result;\n  }\n\n  calculateIndex(x, y, width, channels) {\n    return channels * x + channels * y * width;\n  }\n\n  handlePixel(x, y, d, result, width, options) {\n    var currentColor, i, j, k, l, newColor, q, ref, ref1;\n    i = this.calculateIndex(x, y, width, options.channels);\n    currentColor = [];\n    for (\n      j = k = 0, ref = options.channels;\n      0 <= ref ? k < ref : k > ref;\n      j = 0 <= ref ? ++k : --k\n    ) {\n      currentColor.push(d[i + j]);\n    }\n    newColor = options.findColor(currentColor);\n    q = [];\n    for (\n      j = l = 0, ref1 = options.channels;\n      0 <= ref1 ? l < ref1 : l > ref1;\n      j = 0 <= ref1 ? ++l : --l\n    ) {\n      q[j] = (d[i + j] - newColor[j]) * options.diffusionFactor;\n    }\n    this.diffuseError(d, q, x, y, width, options);\n    return this.applyNewColor(result, width, newColor, i, options);\n  }\n\n  diffuseError(d, q, x, y, width, options) {\n    var channelOffset, entry, index, k, l, len, ref, ref1, results;\n    ref = options.matrix;\n    results = [];\n    for (k = 0, len = ref.length; k < len; k++) {\n      entry = ref[k];\n      index = this.calculateIndex(\n        x + options.step * entry.x,\n        y + options.step * entry.y,\n        width,\n        options.channels\n      );\n      for (\n        channelOffset = l = 0, ref1 = options.channels;\n        0 <= ref1 ? l < ref1 : l > ref1;\n        channelOffset = 0 <= ref1 ? ++l : --l\n      ) {\n        d[index + channelOffset] += entry.factor * q[channelOffset];\n      }\n      results.push(options.clip(d, index));\n    }\n    return results;\n  }\n\n  applyNewColor(buffer, width, newColor, i, options) {\n    var di, dx, dy, j, k, ref, results;\n    results = [];\n    for (\n      dx = k = 0, ref = options.step;\n      0 <= ref ? k < ref : k > ref;\n      dx = 0 <= ref ? ++k : --k\n    ) {\n      results.push(\n        (function() {\n          var l, ref1, results1;\n          results1 = [];\n          for (\n            dy = l = 0, ref1 = options.step;\n            0 <= ref1 ? l < ref1 : l > ref1;\n            dy = 0 <= ref1 ? ++l : --l\n          ) {\n            di = i + options.channels * dx + options.channels * width * dy;\n            results1.push(\n              (function() {\n                var m, ref2, results2;\n                results2 = [];\n                for (\n                  j = m = 0, ref2 = options.channels;\n                  0 <= ref2 ? m < ref2 : m > ref2;\n                  j = 0 <= ref2 ? ++m : --m\n                ) {\n                  results2.push((buffer[di + j] = newColor[j]));\n                }\n                return results2;\n              })()\n            );\n          }\n          return results1;\n        })()\n      );\n    }\n    return results;\n  }\n}\n","import Zoom from './Zoom.js';\n\nexport default function main(image) {\n  return imageToBlob(image).then(fileToBinary);\n}\n\nexport function contrast(imageData, contrast = 50) {\n  const data = imageData.data;\n  contrast = contrast / 100 + 1; //convert to decimal & shift range: [0..2]\n  const intercept = 128 * (1 - contrast);\n  for (let i = 0; i < data.length; i += 4) {\n    data[i] = data[i] * contrast + intercept;\n    data[i + 1] = data[i + 1] * contrast + intercept;\n    data[i + 2] = data[i + 2] * contrast + intercept;\n  }\n  return imageData;\n}\n\nexport function threshold(data, _, threshold = _) {\n  for (let i = 0; i < data.length; i += 4) {\n    const r = data[i];\n    const g = data[i + 1];\n    const b = data[i + 2];\n\n    const test = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n\n    const v = test >= threshold ? 255 : 0;\n    data[i] = data[i + 1] = data[i + 2] = v;\n  }\n\n  invertPotentialInk(data);\n\n  return data;\n}\n\nexport function invertPotentialInk(imageData) {\n  const zoom = new Zoom(imageData);\n  for (let y = 0; y < 192 / 8; y++) {\n    for (let x = 0; x < 256 / 8; x++) {\n      const block = zoom.pixel(x, y);\n\n      let inkCount = 0;\n      for (let i = 0; i < 8 * 8 * 4; i += 4) {\n        if (block[i] === 0) {\n          // black = ink\n          inkCount = inkCount + 1;\n        }\n      }\n\n      if (inkCount < 32) {\n        // flip\n        for (let i = 0; i < 8 * 8 * 4; i += 4) {\n          const c = block[i] === 0 ? 255 : 0;\n          block[i] = block[i + 1] = block[i + 2] = c;\n        }\n      }\n    }\n  }\n  return imageData;\n}\n\nfunction crop(\n  source = { width: 0, height: 0 },\n  destination = { width: 0, height: 0 }\n) {\n  // result:\n  let x = 0;\n  let y = 0;\n\n  // which is longest side\n  let longest = 'width';\n  let shortest = 'height';\n  if (destination.width < destination.height) {\n    [longest, shortest] = [shortest, longest];\n  }\n\n  // get divisor\n  const d = source[longest] / destination[longest]; // FIXME does this work for scaling up?\n\n  const width = (destination.width * d) | 0;\n  const height = (destination.height * d) | 0;\n\n  if (longest === 'height') {\n    x = (source[shortest] - width) / 2;\n  } else {\n    y = (source[shortest] - height) / 2;\n  }\n\n  return { x, y, width, height };\n}\n\nexport function imageToCanvas(\n  img,\n  scale = { width: img.width, height: img.height }\n) {\n  const canvas = document.createElement('canvas');\n  canvas.style.imageRendering = 'pixelated';\n  const ctx = canvas.getContext('2d');\n  canvas.width = scale.width;\n  canvas.height = scale.height;\n\n  const { x, y, height, width } = crop(img, canvas);\n\n  ctx.drawImage(img, x, y, width, height, 0, 0, canvas.width, canvas.height);\n\n  return ctx;\n}\n\nexport function imageToPixels(img, scale) {\n  const ctx = imageToCanvas(img, scale);\n  return ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);\n}\n\nexport async function imageToBlob(img, ctx = imageToCanvas(img)) {\n  return new Promise(resolve => {\n    const canvas = ctx.canvas;\n    canvas.toBlob(file => resolve(file));\n  });\n}\n\nexport function fileToBinary(file) {\n  return new Promise(resolve => {\n    const reader = new window.FileReader();\n    reader.onloadend = () => resolve(new Uint8Array(reader.result));\n    reader.readAsArrayBuffer(file);\n  });\n}\n","import Dither from './Dither.js';\nimport Zoom from './Zoom.js';\nimport { imageToCanvas, contrast } from './image.js';\nimport {\n  attributesForBlock,\n  readAttributes,\n  pixelsForSCR,\n  putAttributes,\n  getInkFromPixel,\n  putPixels,\n} from './scr.js';\n\nexport async function dither({ url, all = false, debug = false }) {\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n  img.src = url;\n  await new Promise((resolve, reject) => {\n    img.onload = resolve;\n    img.onerror = reject;\n  });\n  if (debug) document.body.appendChild(img);\n  const ctx = imageToCanvas(img, { width: 256, height: 192 });\n  const canvas = ctx.canvas;\n  const w = canvas.width;\n  const h = canvas.height;\n\n  if (debug) document.body.appendChild(canvas);\n\n  // the buffer is used to draw into as a temp space\n  const bufferCtx = document.createElement('canvas').getContext('2d');\n  bufferCtx.canvas.width = w;\n  bufferCtx.canvas.height = h;\n\n  if (debug) document.body.appendChild(bufferCtx.canvas);\n\n  const dither = new Dither({\n    matrix: Dither.matrices.none,\n    step: 1,\n  });\n\n  const { imageData: inkData } = await render(ctx, bufferCtx, dither, {\n    diffusionFactor: 0.1,\n    matrix: Dither.matrices.atkinson,\n  });\n\n  const { imageData: pixelData } = await renderFromInk(bufferCtx, bufferCtx);\n\n  // load all the final output into SCR format - starting with binary for pixels\n  const pixels = new Uint8Array((256 * 192) / 8 + 768);\n  putPixels(0, pixels, pixelData.data);\n  putPixels(1, pixels, pixelData.data);\n  putPixels(2, pixels, pixelData.data);\n\n  // then try to work out the attributes (bright, ink and paper)\n  putAttributes(pixels, inkData);\n\n  if (all) {\n    return {\n      pixels,\n      inkData,\n      pixelData,\n      originalData: ctx.getImageData(0, 0, w, h),\n    };\n  }\n\n  return pixels; // this is the raw binary .src format\n}\n\nasync function pixelsToImage(pixels) {\n  const ctx = document.createElement('canvas').getContext('2d');\n  const canvas = ctx.canvas;\n  canvas.width = 256;\n  canvas.height = 192;\n\n  ctx.putImageData(pixels, 0, 0);\n\n  const url = canvas.toDataURL('image/png');\n  const img = new Image();\n  img.src = url;\n  return new Promise(resolve => (img.onload = () => resolve(img)));\n}\n\nexport default async function main(\n  url = `https://twivatar.glitch.me/${prompt('Give me a twitter handle:')}`\n) {\n  // export default async function main(url = './image-manip/tap-js.png') {\n  // const username = prompt('Give me a twitter handle:');\n\n  // ctx = drawing context with our source image\n  const { pixels, inkData, pixelData, originalData } = await dither(\n    // `https://twivatar.glitch.me/${username}`,\n    url,\n    true\n  );\n\n  const scrBlob = new Blob([pixels], {\n    'content-type': 'application/binary',\n  });\n  const scrURL = URL.createObjectURL(scrBlob);\n\n  const container = document.createElement('div');\n  document.body.appendChild(container);\n\n  const scrCtx = document.createElement('canvas').getContext('2d');\n  scrCtx.canvas.width = 256;\n  scrCtx.canvas.height = 192;\n  container.appendChild(scrCtx.canvas);\n  // validate our pixels by translating the SCR binary back into a canvas\n  pixelsForSCR(pixels, scrCtx);\n\n  const ul = document.createElement('ul');\n  ul.innerHTML = `<li><a href=\"${scrURL}\" download=\"image.scr\">Download .SCR file</a></li>`;\n\n  const li = document.createElement('li');\n  ul.appendChild(li);\n  const attribsLI = document.createElement('li');\n  ul.appendChild(attribsLI);\n  document.body.appendChild(ul);\n\n  // put all the image data into imgs\n  const img2 = await pixelsToImage(originalData);\n  container.appendChild(img2);\n  const inkImg = await pixelsToImage(inkData);\n  container.appendChild(inkImg);\n  const pixelImg = await pixelsToImage(pixelData);\n  container.appendChild(pixelImg);\n\n  const zoomOriginal = new Zoom(img2);\n  const zoomPixel = new Zoom(pixelImg);\n  const zoomInk = new Zoom(inkImg);\n  const zoomResult = new Zoom(scrCtx);\n\n  const rootCanvas = document.querySelector('canvas');\n  rootCanvas.classList.add('crosshair');\n\n  let hover = true;\n\n  rootCanvas.onclick = () => {\n    hover = !hover;\n  };\n\n  rootCanvas.onmousemove = e => {\n    if (!hover) return;\n    const x = (e.pageX / 8) | 0;\n    const y = (e.pageY / 8) | 0;\n    zoomResult.seeXY(x, y);\n    zoomOriginal.seeXY(x, y);\n    zoomInk.seeXY(x, y);\n    zoomPixel.seeXY(x, y);\n    li.innerHTML = `{ x: ${x}, y: ${y} }`;\n    const block = zoomInk.pixel(x, y);\n    const byte = attributesForBlock(block);\n    window.attributesForBlock = attributesForBlock.bind(null, block);\n    const debug = y === 18 && x === 20;\n    const attribs = readAttributes(byte, debug);\n    const ink = attribs.ink.join(',');\n    const paper = attribs.paper.join(',');\n    attribsLI.innerHTML = `ink: ${ink} (${attribs.values.ink}) <span class=\"block\" style=\"background: rgb(${ink})\"></span>, paper: ${paper} (${attribs.values.paper}) <span class=\"block\" style=\"background: rgb(${paper})\"></span>`;\n  };\n}\n\nasync function render(ctx, bufferCtx, dither, options = {}) {\n  const w = ctx.canvas.width;\n  const h = ctx.canvas.height;\n  const buffer = contrast(ctx.getImageData(0, 0, w, h), 10);\n  const res = dither.dither(buffer.data, w, options);\n  const imageData = new ImageData(new Uint8ClampedArray(res), w, h);\n  bufferCtx.putImageData(imageData, 0, 0);\n\n  return { imageData };\n}\n\nfunction putInkForBlock(\n  zoom,\n  x,\n  y,\n  newBlock = new Uint8ClampedArray(8 * 8 * 4)\n) {\n  const block = zoom.pixel(x, y);\n  // 1: find how many colours we're dealing with (256 elements)\n  // 2: if 2 - switch them to majority paper (0b0) and least ink (0b1)\n  // 3: if more than two, order then select\n  const print = x === 3 && y === 1;\n  const byte = attributesForBlock(block, print);\n  const attributes = readAttributes(byte);\n\n  if (print) console.log(attributes);\n\n  for (let i = 0; i < 64; i++) {\n    const ink = getInkFromPixel([...block.slice(i * 4, i * 4 + 3)]);\n\n    if (ink === attributes.values.ink) {\n      newBlock.set([0, 0, 0, 255], i * 4);\n    } else if (ink === attributes.values.paper) {\n      newBlock.set([255, 255, 255, 255], i * 4);\n    } else {\n      newBlock.set([0, 0, 0, 255], i * 4);\n    }\n  }\n\n  return newBlock;\n}\n\nasync function renderFromInk(ctx, bufferCtx) {\n  const w = ctx.canvas.width;\n  const h = ctx.canvas.height;\n  const buffer = ctx.getImageData(0, 0, w, h);\n\n  const zoom = new Zoom(buffer.data);\n\n  const blockBuffer = new Uint8ClampedArray(8 * 8 * 4);\n\n  for (let y = 0; y < 192 / 8; y++) {\n    for (let x = 0; x < 256 / 8; x++) {\n      putInkForBlock(zoom, x, y, blockBuffer);\n\n      bufferCtx.putImageData(new ImageData(blockBuffer, 8, 8), x * 8, y * 8);\n    }\n  }\n\n  const imageData = bufferCtx.getImageData(0, 0, w, h);\n\n  return { imageData };\n}\n\nif (window.location.search.includes('retrofy')) main();\n","import drop from '../lib/dnd.js';\nimport { pixelsForSCR } from './lib/scr.js';\nimport { $ } from '../lib/$.js';\nimport save from '../lib/save.js';\nimport { dither } from './lib/retrofy.js';\n\nconst result = $('#result')[0];\n\nfunction basename(filename) {\n  return filename\n    .split('.')\n    .slice(0, -1)\n    .join('.');\n}\n\nfunction container(filename, altDownload) {\n  const isSCR = filename.toUpperCase().endsWith('.SCR');\n\n  const canvas = document.createElement('canvas');\n  canvas.width = 256;\n  canvas.height = 192;\n  const ctx = canvas.getContext('2d');\n  const div = document.createElement('div');\n  div.className = 'container';\n  div.appendChild(canvas);\n\n  const button = document.createElement('button');\n  div.appendChild(button);\n  button.onclick = async () => {\n    const file = await new Promise(resolve => canvas.toBlob(resolve));\n\n    save(file, basename(filename) + '.png');\n  };\n  button.innerText = 'Download PNG';\n\n  if (!isSCR) {\n    const button = document.createElement('button');\n    div.appendChild(button);\n    button.onclick = async () => {\n      save(altDownload, basename(filename) + '.scr');\n    };\n    button.innerText = 'Download SCR';\n  }\n\n  result.prepend(div);\n  return ctx;\n}\n\nasync function fileHandler(data, filename, type) {\n  if (filename.toUpperCase().endsWith('.SCR')) {\n    pixelsForSCR(data, container(filename));\n  } else {\n    const blob = new Blob([data], { type });\n    const url = URL.createObjectURL(blob);\n    const res = await dither({ url });\n    console.log(res);\n    pixelsForSCR(res, container(filename, res));\n    URL.revokeObjectURL(url);\n  }\n}\n\ndrop(document.body, fileHandler);\n\n$('input').on('change', event => {\n  const file = event.target.files[0];\n  const reader = new FileReader();\n  reader.onload = event =>\n    fileHandler(new Uint8Array(event.target.result), file.name, file.type);\n  reader.readAsArrayBuffer(file);\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}